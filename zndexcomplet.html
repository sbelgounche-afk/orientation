<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ittijah - Guide des M√©tiers et Orientation</title>
    <meta name="description" content="Guide d'orientation scolaire pour les √©l√®ves marocains.">
    
    <style>
        /* --- 1. DESIGN SYSTEM & VARIABLES --- */
        :root {
            /* Palette de couleurs (Mode Clair par d√©faut) */
            --primary: #006064;
            --primary-light: #4DD0E1;
            --secondary: #009688;
            --accent: #FFC107;
            --accent-text: #333333;
            --danger: #ef5350;
            
            /* Backgrounds & Textes */
            --bg-body: #F8F9FA;
            --bg-surface: #ffffff;
            --bg-input: #F3F4F6;
            --text-main: #1F2937;
            --text-muted: #6B7280;
            --border-color: #E5E7EB;
            
            /* UI Elements */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --radius-sm: 6px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-pill: 50px;
            
            /* Transitions */
            --transition-base: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Mode Sombre (Dark Mode) */
        [data-theme="dark"] {
            --bg-body: #0F172A;
            --bg-surface: #1E293B;
            --bg-input: #334155;
            --text-main: #F3F4F6;
            --text-muted: #9CA3AF;
            --border-color: #334155;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.3);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.4);
        }

        /* --- 2. RESET & BASE --- */
        * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }

        a { text-decoration: none; color: inherit; }
        ul { list-style: none; }
        button, input, select { font-family: inherit; outline: none; }

        /* --- 3. LAYOUT & CONTAINER --- */
        .container {
            width: 100%;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* --- 4. NAVBAR (PROFESSIONAL & RESPONSIVE) --- */
        header {
            background: var(--bg-surface);
            box-shadow: var(--shadow-sm);
            position: sticky;
            top: 0;
            z-index: 50;
            border-bottom: 1px solid var(--border-color);
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--primary);
            display: flex;
            align-items: center;
            gap: 8px;
            letter-spacing: -0.5px;
        }
        .logo span { color: var(--secondary); }

        /* Desktop Nav */
        .nav-links {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .nav-links button {
            background: transparent;
            border: none;
            font-size: 0.95rem;
            font-weight: 500;
            color: var(--text-muted);
            cursor: pointer;
            padding: 8px 16px;
            border-radius: var(--radius-pill);
            transition: var(--transition-base);
        }

        .nav-links button:hover, .nav-links button.active {
            color: var(--primary);
            background-color: rgba(0, 96, 100, 0.08);
        }

        /* Mobile Menu Toggle (Hamburger) */
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            flex-direction: column;
            gap: 5px;
            cursor: pointer;
            padding: 5px;
            z-index: 60;
        }
        .menu-toggle span {
            width: 25px;
            height: 3px;
            background-color: var(--text-main);
            border-radius: 2px;
            transition: var(--transition-base);
        }

        /* Mobile Sidebar */
        .mobile-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 55;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition-base);
            backdrop-filter: blur(2px);
        }
        
        .mobile-nav {
            position: fixed;
            top: 0; right: -100%;
            width: 80%;
            max-width: 300px;
            height: 100%;
            background: var(--bg-surface);
            z-index: 60;
            box-shadow: -5px 0 15px rgba(0,0,0,0.1);
            transition: var(--transition-base);
            display: flex;
            flex-direction: column;
            padding: 80px 20px 20px 20px;
        }

        .mobile-nav.open { right: 0; }
        .mobile-overlay.open { opacity: 1; visibility: visible; }

        .mobile-nav button {
            background: transparent;
            border: none;
            text-align: left;
            font-size: 1.1rem;
            padding: 15px;
            color: var(--text-main);
            border-bottom: 1px solid var(--border-color);
            width: 100%;
        }

        /* --- 5. COMPONENTS --- */
        .card {
            background: var(--bg-surface);
            border-radius: var(--radius-md);
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: var(--transition-base);
        }

        .section-title {
            font-size: 1.5rem;
            color: var(--primary);
            margin-bottom: 20px;
            font-weight: 700;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 12px 28px;
            border-radius: var(--radius-pill);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-base);
            border: none;
            font-size: 1rem;
            gap: 8px;
        }

        .btn:active { transform: scale(0.98); }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            box-shadow: 0 4px 10px rgba(0, 150, 136, 0.3);
        }
        .btn-primary:hover { opacity: 0.9; transform: translateY(-2px); }

        .btn-outline {
            background: transparent;
            border: 2px solid var(--primary);
            color: var(--primary);
        }
        .btn-outline:hover { background: rgba(0, 96, 100, 0.05); }

        .btn-block { width: 100%; }

        /* Inputs */
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 0.9rem; color: var(--text-main); }
        
        input, select {
            width: 100%;
            padding: 14px;
            border: 2px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            background: var(--bg-input);
            color: var(--text-main);
            transition: var(--transition-base);
        }
        input:focus, select:focus {
            border-color: var(--secondary);
            background: var(--bg-surface);
            box-shadow: 0 0 0 3px rgba(0, 150, 136, 0.1);
        }

        /* --- 6. SECTIONS ANIMATION --- */
        section {
            display: none;
            padding-top: 30px;
            padding-bottom: 50px;
            animation: fadeIn 0.4s ease-out;
        }
        section.active { display: block; }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* --- 7. JOB GRID --- */
        .job-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }

        .job-card {
            background: var(--bg-surface);
            border-radius: var(--radius-md);
            overflow: hidden;
            border: 1px solid var(--border-color);
            transition: var(--transition-base);
            cursor: pointer;
            position: relative;
        }

        .job-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-light);
        }

        .job-header {
            padding: 16px;
            background: linear-gradient(to right, rgba(0, 96, 100, 0.05), transparent);
            border-bottom: 1px solid var(--border-color);
        }

        .job-title { font-weight: 700; color: var(--text-main); font-size: 1.1rem; }
        
        .job-category {
            font-size: 0.75rem;
            color: var(--secondary);
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 0.5px;
            margin-top: 5px;
            display: inline-block;
        }

        .job-body { padding: 16px; font-size: 0.95rem; color: var(--text-muted); min-height: 80px; }

        /* --- 8. QUIZ & PROGRESS --- */
        .progress-container { margin-bottom: 25px; }
        .progress-bar-bg { height: 8px; background: var(--border-color); border-radius: 4px; overflow: hidden; }
        .progress-bar-fill { height: 100%; background: var(--secondary); width: 0%; transition: width 0.4s ease; }

        .options-grid { display: grid; grid-template-columns: 1fr; gap: 12px; }
        @media(min-width: 600px) { .options-grid { grid-template-columns: 1fr 1fr; } }

        .option-btn {
            background: var(--bg-surface);
            border: 2px solid var(--border-color);
            padding: 16px;
            border-radius: var(--radius-md);
            text-align: left;
            transition: var(--transition-base);
            cursor: pointer;
            font-weight: 600;
            color: var(--text-main);
            display: flex;
            align-items: center;
        }
        .option-btn:hover { border-color: var(--secondary); background-color: rgba(0, 150, 136, 0.05); }

        /* --- 9. MODAL --- */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            backdrop-filter: blur(4px);
        }
        
        .modal.open { display: flex; }

        .modal-content {
            background: var(--bg-surface);
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            border-radius: var(--radius-lg);
            padding: 30px;
            position: relative;
            box-shadow: var(--shadow-lg);
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .close-modal {
            position: absolute; top: 20px; right: 20px;
            font-size: 24px; cursor: pointer; color: var(--text-muted);
            background: none; border: none; padding: 5px;
        }

        /* --- 10. COMPARATOR & STATS --- */
        .stat-box {
            background: var(--bg-surface);
            padding: 20px;
            border-radius: var(--radius-md);
            text-align: center;
            border: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
        }
        .stat-val { font-size: 2rem; font-weight: 800; color: var(--primary); display: block; }
        .stat-label { font-size: 0.85rem; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; }

        .compare-controls {
            display: grid;
            gap: 15px;
            background: var(--bg-input);
            padding: 20px;
            border-radius: var(--radius-md);
            margin-bottom: 30px;
        }
        @media(min-width: 768px) { .compare-controls { grid-template-columns: 1fr 1fr auto; align-items: end; } }

        /* --- 11. TIMELINE --- */
        .timeline { position: relative; padding-left: 20px; margin-top: 20px; border-left: 2px solid var(--border-color); }
        .timeline-item { margin-bottom: 25px; position: relative; padding-left: 25px; }
        .timeline-dot {
            width: 16px; height: 16px; background: var(--secondary);
            border-radius: 50%; position: absolute; left: -9px; top: 5px;
            border: 3px solid var(--bg-surface);
        }
        .timeline-item.is-current .timeline-dot { background: var(--accent); transform: scale(1.2); }

        /* --- 12. TOASTS --- */
        .toast-container {
            position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
            z-index: 2000; width: 90%; max-width: 400px; display: flex; flex-direction: column; gap: 10px;
        }
        .toast {
            background: #333; color: white; padding: 16px; border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg); font-size: 0.95rem; display: flex; align-items: center;
            justify-content: space-between; animation: slideInBottom 0.3s ease;
        }
        .toast.success { border-left: 5px solid var(--secondary); }
        .toast.error { border-left: 5px solid var(--danger); }
        @keyframes slideInBottom { from { transform: translateY(100%); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* --- 13. RESPONSIVE MEDIA QUERIES --- */
        @media (max-width: 768px) {
            .nav-links { display: none; } /* Hide desktop nav */
            .menu-toggle { display: flex; } /* Show burger */
            .job-grid { grid-template-columns: 1fr; } /* Full width cards on mobile */
            .modal-content { padding: 20px; width: 100%; max-height: 95vh; }
            h1 { font-size: 1.8rem; }
            .section-title { font-size: 1.3rem; }
        }

        /* --- THEME TOGGLE MODERN (SVG) --- */
        .theme-toggle-wrapper {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle-btn {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: var(--bg-input);
            border: 1px solid var(--border-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            outline: none;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            color: var(--text-main);
            overflow: hidden;
        }

        /* Hover Effect */
        .theme-toggle-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-color: var(--primary);
        }

        /* Active Click */
        .theme-toggle-btn:active { transform: scale(0.95); }

        /* SVG Icons Logic */
        .theme-toggle-btn svg {
            width: 22px;
            height: 22px;
            fill: none;
            stroke: currentColor;
            stroke-width: 2;
            stroke-linecap: round;
            stroke-linejoin: round;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.27, 1.55), opacity 0.3s ease;
            position: absolute;
        }

        /* Inactive icons are hidden */
        .icon-sun, .icon-moon {
            opacity: 0;
            transform: rotate(-90deg) scale(0.5);
            pointer-events: none;
        }

        /* Visible Icon States */
        body:not([data-theme="dark"]) .icon-moon {
            opacity: 1;
            transform: rotate(0deg) scale(1);
        }

        body[data-theme="dark"] .icon-sun {
            opacity: 1;
            transform: rotate(0deg) scale(1);
        }

        /* Dark Mode Button Styling */
        body[data-theme="dark"] .theme-toggle-btn {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.2);
        }
        
        body[data-theme="dark"] .theme-toggle-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
        }

        /* Filter Bar */
        .filter-bar {
            background: var(--bg-surface); padding: 15px; border-radius: var(--radius-md);
            margin-bottom: 25px; display: flex; flex-direction: column; gap: 15px;
            box-shadow: var(--shadow-sm); border: 1px solid var(--border-color);
        }
        @media(min-width: 600px) { .filter-bar { flex-direction: row; align-items: center; } }
        
    </style>
</head>
<body>

    <!-- MODAL DETAIL -->
    <div class="modal" id="jobModal">
        <div class="modal-content">
            <button class="close-modal" onclick="window.app.closeModal()">&times;</button>
            <div id="modalBody"></div>
        </div>
    </div>

    <!-- MOBILE MENU OVERLAY -->
    <div class="mobile-overlay" id="mobileOverlay" onclick="window.app.toggleMenu()"></div>

    <!-- HEADER -->
    <header>
        <div class="container">
            <nav>
                <div class="logo">Ittijah<span>Maroc</span></div>
                
                <!-- Desktop Links -->
                <div class="nav-links" id="navLinks">
                    <button onclick="window.app.navigate('dashboard')">Accueil</button>
                    <button onclick="window.app.navigate('jobs')">M√©tiers</button>
                    <button onclick="window.app.navigate('comparator')">Comparateur</button>
                    <button onclick="window.location.href='m√©tiers.html'">Par Branche</button>
                    <button onclick="window.location.href='√©coles/premier.html'">√âcoles</button>
                    <button onclick="window.app.logout()">Quitter</button>
                    
                    <!-- BOUTON TH√àME DESKTOP MODERNE -->
                    <div class="theme-toggle-wrapper">
                        <button id="themeBtn" class="theme-toggle-btn" onclick="window.app.toggleTheme()" aria-label="Changer le th√®me">
                            <!-- Moon Icon (Default) -->
                            <svg class="icon-moon" viewBox="0 0 24 24">
                                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                            </svg>
                            <!-- Sun Icon (Dark Mode) -->
                            <svg class="icon-sun" viewBox="0 0 24 24">
                                <circle cx="12" cy="12" r="5"></circle>
                                <line x1="12" y1="1" x2="12" y2="3"></line>
                                <line x1="12" y1="21" x2="12" y2="23"></line>
                                <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                                <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                                <line x1="1" y1="12" x2="3" y2="12"></line>
                                <line x1="21" y1="12" x2="23" y2="12"></line>
                                <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                                <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Mobile Burger -->
                <button class="menu-toggle" onclick="window.app.toggleMenu()">
                    <span></span><span></span><span></span>
                </button>
            </nav>
        </div>
    </header>

    <!-- MOBILE NAV DRAWER -->
    <div class="mobile-nav" id="mobileNav">
        <div style="margin-bottom: 20px; display:flex; justify-content:space-between; align-items:center;">
            <strong style="font-size:1.2rem; color:var(--primary);">Menu</strong>
            
            <!-- BOUTON TH√àME MOBILE MODERNE -->
            <div class="theme-toggle-wrapper">
                <button id="themeBtnMobile" class="theme-toggle-btn" onclick="window.app.toggleTheme()" aria-label="Changer le th√®me" style="border:none; background:none;">
                    <svg class="icon-moon" viewBox="0 0 24 24"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>
                    <svg class="icon-sun" viewBox="0 0 24 24"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>
                </button>
            </div>
        </div>
        <button onclick="window.app.navigate('dashboard'); window.app.toggleMenu()">üè† Accueil</button>
        <button onclick="window.app.navigate('jobs'); window.app.toggleMenu()">üíº M√©tiers</button>
        <button onclick="window.app.navigate('comparator'); window.app.toggleMenu()">‚öñÔ∏è Comparateur</button>
        <button onclick="window.location.href='m√©tiers.html'; window.app.toggleMenu()">üìÇ Par Branche</button>
        <button onclick="window.location.href='√©coles/premier.html'; window.app.toggleMenu()">üéì √âcoles</button>
        <div style="flex:1"></div>
        <button onclick="window.app.logout(); window.app.toggleMenu()" style="color:var(--danger)">üö™ Quitter</button>
    </div>

    <main class="container">

        <!-- 1. ONBOARDING -->
        <section id="onboarding">
            <div class="card" style="max-width: 500px; margin: 40px auto; text-align: center; border-top: 5px solid var(--secondary);">
                <div style="font-size: 3rem; margin-bottom: 10px;">üëã</div>
                <h2 class="section-title">Bienvenue sur Orient'Maroc</h2>
                <p style="color: var(--text-muted); margin-bottom: 30px;">Ton guide personnel pour construire ton avenir au Maroc.</p>

                <form onsubmit="window.app.saveProfile(event)">
                    <div class="form-group">
                        <label style="text-align:left">Ton Pr√©nom</label>
                        <input type="text" id="name" required placeholder="Ex: Sara">
                    </div>

                    <div class="form-group">
                        <label style="text-align:left">Niveau Scolaire</label>
                        <select id="level" required onchange="window.app.toggleStream()">
                            <option value="">Choisir...</option>
                            <option value="3AC">3√®me Ann√©e Coll√®ge</option>
                            <option value="TC">Tronc Commun</option>
                            <option value="1BAC">1√®re Ann√©e Bac</option>
                            <option value="2BAC">2√®me Ann√©e Bac</option>
                        </select>
                    </div>

                    <div class="form-group" id="streamGroup" style="display:none;">
                        <label style="text-align:left">Fili√®re (Bac)</label>
                        <select id="stream">
                            <option value="">Aucune / Je ne sais pas</option>
                            <option value="SC_Maths">Sciences Maths</option>
                            <option value="SC_Exp">Sciences Exp√©rimentales</option>
                            <option value="STEG">Sciences Techniques (STEG)</option>
                            <option value="EG">√âconomie & Gestion</option>
                            <option value="SH">Sciences Humaines</option>
                            <option value="LP">Lettres & Philo</option>
                        </select>
                    </div>

                    <button type="submit" class="btn btn-primary btn-block">Commencer mon aventure üöÄ</button>
                </form>
            </div>
        </section>

        <!-- 2. DASHBOARD -->
        <section id="dashboard">
            <div class="card" style="background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; border:none;">
                <h1>Salut, <span id="uName">√âl√®ve</span> ! üëã</h1>
                <p style="opacity: 0.95; margin-top: 10px; font-size: 1.1rem;">Pr√™t √† d√©couvrir ton avenir professionnel ?</p>
                <div style="margin-top: 25px;">
                    <button class="btn" style="background: white; color: var(--primary);" onclick="window.app.startQuiz()">‚ú® Passer le Test d'Orientation</button>
                </div>
            </div>

            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; margin-bottom: 30px;">
                <div class="stat-box">
                    <span class="stat-val" id="totalJobsCount">0</span>
                    <span class="stat-label">M√©tiers</span>
                </div>
                <div class="stat-box">
                    <span class="stat-val" id="totalCatsCount">0</span>
                    <span class="stat-label">Secteurs</span>
                </div>
            </div>

            <h3 class="section-title">üí° Suggestions du jour</h3>
            <div class="job-grid" id="featuredJobs"></div>
        </section>

        <!-- 3. QUIZ -->
        <section id="quiz">
            <div class="card">
                <div class="progress-container">
                    <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-size:0.85rem; font-weight:600; color:var(--text-muted);">
                        <span>Progression</span>
                        <span id="quizProgressText">0%</span>
                    </div>
                    <div class="progress-bar-bg">
                        <div class="progress-bar-fill" id="quizProgress"></div>
                    </div>
                </div>
                <h2 id="qText" style="margin-bottom: 25px; font-size: 1.3rem;">Question...</h2>
                <div id="qOptions" class="options-grid"></div>
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-outline" onclick="window.app.navigate('dashboard')">Annuler le test</button>
            </div>
        </section>

        <!-- 4. RESULTS -->
        <section id="results">
            <div class="card" style="text-align: center; padding: 40px 20px;">
                <div style="font-size: 3rem; margin-bottom: 10px;">üéØ</div>
                <h2 class="section-title">Analyse Termin√©e</h2>
                <p>Ton profil d√©tect√© : <strong id="resProfile" style="color:var(--primary)"></strong></p>
                <div id="resTags" style="display: flex; gap: 10px; flex-wrap: wrap; margin-top: 20px; justify-content:center;"></div>
            </div>

            <div class="card">
                <h3 class="section-title">üíº M√©tiers recommand√©s</h3>
                <p style="font-size: 0.9rem; color: var(--text-muted); margin-bottom: 20px;">
                    Bas√©s sur ta fili√®re (<span id="resStream"></span>) et tes r√©ponses.
                </p>
                <div class="job-grid" id="resJobs"></div>
            </div>

            <div style="text-align: center;">
                <button class="btn btn-primary" onclick="window.app.navigate('dashboard')">Retour Accueil</button>
            </div>
        </section>

        <!-- 5. JOBS DIRECTORY -->
        <section id="jobs">
            <div class="filter-bar">
                <div style="flex:2; width:100%;">
                    <input type="text" id="jobSearch" placeholder="üîç Rechercher un m√©tier, un mot-cl√©..." oninput="window.app.filterJobs(document.getElementById('categoryFilter').value)">
                </div>
                <div style="flex:1; width:100%;">
                    <select id="categoryFilter" onchange="window.app.filterJobs(this.value)">
                        <option value="all">Toutes les cat√©gories</option>
                    </select>
                </div>
                <div style="color: var(--text-muted); font-size: 0.9rem; font-weight:600; text-align:right; width:100%;">
                    <span id="currentCount">0</span> m√©tiers
                </div>
            </div>
            <div class="job-grid" id="jobsList"></div>
        </section>

        <!-- 6. COMPARATOR SECTION -->
        <section id="comparator">
            <div class="card">
                <h2 class="section-title">‚öñÔ∏è Comparateur de Fili√®res</h2>
                <p style="margin-bottom: 25px; color: var(--text-muted);">H√©site entre deux voies ? Compare-les pour faire le bon choix.</p>

                <div class="compare-controls">
                    <div>
                        <label>Voie 1</label>
                        <select id="streamSelect1">
                            <option value="">-- S√©lectionner --</option>
                            <option value="sc_maths">Sciences Maths</option>
                            <option value="sc_exp">Sciences Exp√©rimentales</option>
                            <option value="eco">√âconomie & Gestion</option>
                            <option value="lettres">Lettres & Philosophie</option>
                            <option value="univ">Universit√© (Litt√©raire/Sc Humaines)</option>
                            <option value="ecoles">√âcoles Sup√©rieures</option>
                            <option value="ofppt">OFPPT (Formation Pro)</option>
                        </select>
                    </div>

                    <div>
                        <label>Voie 2</label>
                        <select id="streamSelect2">
                            <option value="">-- S√©lectionner --</option>
                            <option value="sc_maths">Sciences Maths</option>
                            <option value="sc_exp">Sciences Exp√©rimentales</option>
                            <option value="eco">√âconomie & Gestion</option>
                            <option value="lettres">Lettres & Philosophie</option>
                            <option value="univ">Universit√© (Litt√©raire/Sc Humaines)</option>
                            <option value="ecoles">√âcoles Sup√©rieures</option>
                            <option value="ofppt">OFPPT (Formation Pro)</option>
                        </select>
                    </div>

                    <button class="btn btn-primary" onclick="window.app.comparator.runComparison()" style="height: 50px; margin-top:0;">Comparer</button>
                </div>
            </div>

            <div id="compareResults" class="job-grid"></div>

            <div style="text-align: center; margin-top: 40px; padding: 20px; background:var(--bg-input); border-radius: var(--radius-md);">
                <p style="margin-bottom: 15px; font-weight:600;">Ind√©cis ? Passez notre test personnalis√©.</p>
                <button class="btn btn-outline" onclick="window.app.startQuiz()">Faire le test d'orientation</button>
            </div>
        </section>

    </main>

    <script>
        // =========================================================================
        // ORIENT'MAROC - SYST√àME D'ORIENTATION INTELLIGENT (Refactoris√© & Optimis√©)
        // =========================================================================

        // --- 1. DONN√âES BRUTES ---
        const RAW_DATA = {
            "Achat": ["Acheteur", "Acheteur industriel", "Acheteur informatique", "Agent de soin", "Assistant achat", "Assistant chef de produit tourisme", "Conducteur de travaux agencement", "Directeur achat", "Ing√©nieur achat", "Ing√©nieur d'√©tudes", "Peintre a√©ronautique", "Photographe assistant", "Professeur fitness", "Responsable achats", "Responsable approvisionnement", "Responsable cr√©dit", "Technicien d'achats", "T√©l√©op√©rateur"],
            "Administratif": ["Adjoint des cadres hospitaliers", "Agent administratif", "Agent distribution courrier", "Agent services g√©n√©raux", "Assistant administratif", "Assistant de direction", "Assistant polyvalent", "Assistant technique", "Charg√© de mission handicap", "Collaborateur administrateur judiciaire", "Dactylo", "Directeur administratif financier", "Directeur associ√©", "Directeur des services techniques", "Directeur g√©n√©ral", "Employ√© administratif", "Gestionnaire administratif", "Greffier", "Responsable administratif", "Responsable des services g√©n√©raux", "R√©dacteur des d√©bats", "Secr√©taire g√©n√©ral", "Standardiste", "Traducteur"],
            "Agricole": ["Agent d'√©levage", "Agent viticole", "Agriculteur", "Apiculteur", "B√ªcheron", "Chauffeur agricole", "Conseiller foncier", "Cueilleur", "Eleveur", "Horticulteur", "Ing√©nieur agricole", "Ing√©nieur agronome", "Magasinier agricole", "Mara√Æcher", "M√©canicien agricole", "Ouvrier agricole", "Palefrenier", "P√©pini√©riste", "Vendangeur"],
            "Alimentation": ["Boucher", "Boulanger", "Caviste", "Charcutier", "Charcutier-traiteur", "Chef boucher", "Chocolatier", "Cuisinier traiteur", "D√©sosseur", "Fromager", "Glacier", "Pizzaiolo", "P√¢tissier chocolatier", "Responsable qualit√© agroalimentaire"],
            "Am√©nagement": ["G√©ographe", "Urbaniste"],
            "Architecture": ["Architecte", "Architecte d'int√©rieur", "Assistant architecte", "BIM Manager", "Cartographe", "Collaborateur d'architecte", "D√©corateur", "Paysagiste"],
            "Artisanat": ["Bijoutier", "Carreleur", "Charpentier", "Charpentier couvreur", "Chaudronnier", "Cordonnier", "Couturier", "Eb√©niste", "Ferronnier", "Fleuriste", "Forgeron", "Gemmologue", "Graveur", "Horloger", "Imprimeur", "Maroquinier", "Mar√©chal ferrant", "Menuisier", "Menuisier poseur aluminium", "Menuisier-agenceur", "M√©tallier serrurier", "Ouvrier boulanger", "Poseur cuisine", "Poseur menuiserie PVC", "P√¢tissier tourier", "P√™cheur", "Relieur", "Serrurier", "Styliste", "Tailleur", "Tailleur de pierre", "Tapissier", "Technicien chaudronnier"],
            "Assurance": ["Actuaire", "Collaborateur agence assurances", "Comptable assurance", "Conseiller commercial assurance", "Conseiller mutualiste", "Courtier", "Courtier en assurances", "Expert en assurances", "Expert en sinistres", "Gestionnaire contrats", "Gestionnaire d'assurances", "Gestionnaire frais de sant√©", "Gestionnaire middle office", "Souscripteur", "Tarificateur assurance"],
            "Banque": ["Analyste cr√©dit", "Charg√© de client√®le", "Charg√© de conformit√©", "Conseiller accueil banque", "Conseiller client√®le", "Dabiste", "Directeur d'agence", "Gestionnaire back office", "Guichetier", "Responsable recouvrement"],
            "Btp": ["Aide-ma√ßon", "Assistant travaux", "Bancheur", "Bardeur", "Calorifugeur", "Canalisateur", "Charg√© d'affaires btp", "Chauffagiste", "Chauffeur tp", "Chef d'√©quipe TP", "Chef d'√©quipe vrd", "Chef de chantier", "Coffreur", "Coffreur bancheur", "Coffreur boiseur", "Conducteur de grue mobile", "Conducteur de nacelle", "Conducteur de pelle", "Conducteur de travaux", "Conducteur engins", "Contremaitre", "Coordinateur technique", "Cordiste", "Courtier travaux", "Couvreur", "Couvreur zingueur", "Cuisiniste", "C√¢bleur", "Dessinateur projeteur √©lectricit√©", "Dessinateur-projeteur b√¢timent", "Deviseur", "Diagnostiqueur immobilier", "Directeur travaux", "D√©samianteur", "Echafaudeur", "Economiste de la construction", "Electricien", "Electricien du b√¢timent", "Etancheur", "Fa√ßadier", "Ferrailleur", "Finisseur", "Foreur", "Formateur CACES", "Frigoriste", "Grutier", "Grutier mobile", "G√©om√®tre topographe", "Ing√©nieur BTP", "Ing√©nieur construction", "Ing√©nieur efficacit√© √©nerg√©tique", "Ing√©nieur g√©otechnicien", "Ing√©nieur structures", "Ing√©nieur travaux", "Ing√©nieur √©tudes de prix", "Manoeuvre", "Ma√ßon", "Menuisier aluminium", "Menuisier poseur", "Miroitier", "M√©treur", "Ouvrier qualifi√©", "Ouvrier vrd", "Peintre en b√¢timent", "Pilote OPC", "Plaquiste", "Plaquiste enduiseur", "Plombier", "Pl√¢trier", "Polisseur", "Pontier", "Projeteur b√©ton arm√©", "Ramoneur", "Responsable maintenance travaux neufs", "Responsable travaux", "Sableur", "Solier moquettiste", "Technicien acoustique", "Technicien b√¢timent", "Technicien g√©nie civil", "Technicien g√©om√®tre"],
            "Chimie": ["Aromaticien", "Biochimiste", "Ing√©nieur chimiste", "Ing√©nieur formulation", "Ing√©nieur g√©nie chimique", "Laborantin", "Responsable de laboratoire", "Responsable laboratoire chimie", "Responsable scientifique", "Technicien biochimiste", "Technicien chimiste", "Technicien de laboratoire", "Technicien de laboratoire biologie", "Technicien g√©nie chimique"],
            "Commerce": ["Agent commercial", "Assistant administratif commercial", "Assistant commercial", "Assistant export", "Buraliste", "Business developer", "Charg√© d'affaires", "Charg√© de d√©veloppement commercial", "Chef de projet CRM", "Chef de projet e-commerce", "Chef de secteur commerce", "Chef de zone export", "Chef des ventes", "Client myst√®re", "Commercial", "Commercial B to C", "Commercial CHR", "Commercial GMS", "Commercial automobile", "Commercial b to b", "Commercial export", "Commercial s√©dentaire", "Commer√ßant", "Conseiller commercial", "Contract manager", "Directeur business unit", "Directeur commercial", "Directeur commercial export", "Directeur de comptes", "Directeur des op√©rations", "Directeur des ventes", "Directeur du d√©veloppement", "Directeur r√©gional", "D√©l√©gu√© commercial", "D√©l√©gu√© v√©t√©rinaire", "Employ√© de pharmacie", "Ing√©nieur avant-vente", "Ing√©nieur commercial", "Ing√©nieur d'affaires", "Ing√©nieur technico-commercial", "Opticien", "Poissonnier", "Promoteur des ventes", "Responsable commercial France", "Responsable commercial export", "Responsable commercial sport", "Responsable commercial s√©dentaire", "Responsable commercial transport", "Responsable d'affaires", "Responsable d√©veloppement commercial", "Responsable e-commerce", "Responsable grands comptes", "Skiman", "Technico-commercial", "T√©l√©conseiller", "VRP"],
            "Communication": ["Assistant chef de projet", "Assistant de communication", "Attach√© de presse", "Charg√© de communication", "Charg√© de communication √©v√©nementielle", "Charg√© de relations publiques", "Chef de projet communication", "Chef de publicit√©", "Conseiller en image", "Directeur de la communication", "Documentaliste ged", "Graphiste", "Infographiste", "Recruteur de donateurs", "Responsable communication", "Responsable partenariats", "Responsable √©ditorial"],
            "Comptabilit√©": ["Agent de facturation", "Agent de recouvrement", "Assistant administratif et comptable", "Assistant comptable", "Assistant facturation", "Auditeur", "Charg√© de recouvrement", "Chef de mission comptable", "Collaborateur comptable", "Commissaire aux comptes", "Comptable", "Comptable Fournisseur", "Comptable auxiliaire", "Comptable client", "Comptable clients recouvrement", "Comptable copropri√©t√©", "Comptable gestion locative", "Comptable g√©n√©ral", "Comptable paie", "Comptable tr√©sorerie", "Directeur comptable", "Expert-comptable", "Responsable administratif comptable", "Responsable audit", "Responsable comptabilit√© analytique", "Responsable comptabilit√© clients", "Responsable comptabilit√© fournisseurs", "Responsable comptable", "Responsable facturation", "Responsable tr√©sorerie", "Secr√©taire comptable", "Technicien comptable", "Tr√©sorier"],
            "Culture": ["Accessoiriste", "Animateur cirque", "Animateur sportif", "Archiviste", "Archiviste documentaliste", "Auteur", "Biblioth√©caire", "Cam√©raman", "Chanteur", "Chef de projet √©v√®nementiel", "Chor√©graphe", "Compositeur", "Com√©dien", "DJ", "Danseur", "Dessinateur", "Documentaliste", "Figurant", "Game designer", "Illustrateur", "Ing√©nieur du son", "Interpr√®te", "Libraire", "Linguiste", "Machiniste", "Mannequin", "Metteur en sc√®ne", "Mod√©liste", "Monteur de stands", "Musicien", "M√©diateur culturel", "Photographe", "Professeur de danse", "Professeur de zumba", "Professeur guitare", "Responsable √©v√©nementiel", "R√©alisateur", "R√©gisseur", "R√©gisseur lumi√®re", "Sculpteur", "Tatoueur", "Technicien audiovisuel", "Technicien du spectacle", "Technicien son"],
            "Digital": ["Charg√© de communication digitale", "Chef de projet digital", "Chef de projet internet", "Community manager", "Designer 3d", "D√©veloppeur iPhone", "D√©veloppeur mobile", "D√©veloppeur web", "Graphiste 2d", "Graphiste 3d", "Graphiste web", "Responsable digital", "R√©dacteur web", "R√©f√©renceur web", "Webmaster"],
            "Droit": ["Assistant juridique", "Avocat", "Clerc de notaire", "Directeur juridique", "Huissier", "Juriste", "Juriste assurance", "Juriste construction", "Juriste contentieux", "Juriste d'entreprise", "Juriste droit de la concurrence", "Juriste droit des affaires", "Juriste en droit public", "Juriste en droit social", "Juriste immobilier", "Juriste international", "Juriste propri√©t√© intellectuelle", "Notaire", "R√©dacteur juridique"],
            "Economie": ["Statisticien", "√âconomiste"],
            "Edition": ["Conducteur offset", "Iconographe"],
            "Emploi public": ["ASVP", "Administratif de la fonction publique", "Agent d'entretien en collectivit√©", "Agent de service", "Agent de tri courrier", "Agent de voirie", "Animateur du patrimoine", "Charg√© de recherche", "Facteur", "Ing√©nieur VRD", "Militaire", "Policier", "Postier", "R√©dacteur territorial", "Surveillant de baignade", "Technicien de recherche", "Technicien environnement"],
            "Enseignement": ["Animateur BAFA", "Assistant p√©dagogique", "Auxiliaire de vie scolaire", "Chef de projet formation", "Chef de service √©ducatif", "Coach sportif", "Conseiller d'orientation", "Conseiller p√©dagogique", "Directeur de centre de formation", "Educateur technique", "Enseignant", "Enseignant chercheur", "Formateur", "Formateur FLE", "Formateur b√¢timent", "Formateur en bureautique", "Formateur gestion du stress", "Formateur insertion", "Formateur vacataire", "Ing√©nieur p√©dagogique", "Ma√Ætre-nageur sauveteur", "Moniteur", "Moniteur auto-√©cole", "Professeur allemand", "Professeur d'anglais", "Professeur de SVT", "Professeur de fran√ßais", "Professeur des √©coles", "Professeur histoire g√©ographie", "Professeur math√©matiques", "Professeur musique", "Professeur philosophie", "Professeur physique", "Professeur √©conomie", "Responsable p√©dagogique", "Surveillant examens", "√âducateur sportif"],
            "Environnement": ["Agent d'entretien des espaces verts", "Agent de tri", "Animateur s√©curit√© environnement", "Assistant d√©veloppement durable", "Biologiste", "Botaniste", "Charg√© de mission RSE", "Coordinateur qhse", "Ecologue", "Elagueur", "Garde forestier", "G√©ologue", "Hydrog√©ologue", "Ing√©nieur environnement", "Ing√©nieur photovoltaique", "Ing√©nieur thermicien", "Installateur thermique", "Jardinier", "Jardinier paysagiste", "Monteur en climatisation", "M√©t√©orologue", "Naturaliste", "Oc√©anographe", "Ouvrier paysagiste", "Releveur de compteur", "Responsable HSE", "Responsable QSE", "Responsable d√©veloppement durable", "Ripeur", "Technicien HVAC", "Technicien de maintenance g√©nie climatique", "Technicien en froid et climatisation", "Technicien en √©lectricit√©", "Technicien forestier", "Technicien gaz", "Technicien g√©nie climatique"],
            "Finance": ["Analyste financier", "Asset manager", "Auditeur financier", "Charg√© de reporting", "Chef de mission audit", "Conseiller Fiscal", "Conseiller financier", "Consolideur", "Contr√¥leur financier", "Credit manager", "Directeur financier", "Fiscaliste", "Gestionnaire financier", "Ing√©nieur financier", "Op√©rateur de march√©", "Responsable administratif financier", "Responsable financier", "Trader"],
            "Gestion": ["Assistant de gestion", "Assistant de gestion PME/PMI", "Business analyst", "Charg√© de contentieux", "Consultant gestion", "Contr√¥leur de gestion", "Delivery manager", "Directeur technique", "Gestionnaire de patrimoine", "Risk manager"],
            "Grande distribution": ["Animateur commercial", "Animateur r√©seau", "Attach√© commercial GMS", "Chef de caisse", "Chef de rayon", "Chef de secteur", "Chef de secteur GMS", "Chef rayon bazar", "Chef rayon boucherie", "Chef rayon boulangerie p√¢tisserie", "Chef rayon charcuterie traiteur", "Chef rayon poissonnerie", "Conseiller de vente", "Directeur de magasin", "Employ√© libre-service", "Employ√© point chaud", "Merchandiseur", "Responsable adjoint magasin", "Responsable commercial GMS", "Responsable drive", "Responsable produits frais", "Responsable rayon", "Responsable rayon poissonnerie"],
            "H√¥tellerie": ["Chef de r√©ception", "Directeur h√¥tel", "Femme de chambre", "Gouvernant", "Majordome", "R√©ceptionniste", "Valet de chambre", "Veilleur de nuit"],
            "Immobilier": ["Administrateur de biens", "Agent commercial immobilier", "Agent immobilier", "Assistant gestion locative", "Chasseur immobilier", "Commercial immobilier", "Conseiller commercial immobilier", "Directeur de copropri√©t√©", "D√©veloppeur foncier", "Gestionnaire de copropri√©t√©", "Gestionnaire immobilier", "Gestionnaire locatif", "Home stager", "Mandataire immobilier", "N√©gociateur immobilier", "N√©gociateur location", "Promoteur", "Prospecteur foncier", "Responsable commercial immobilier", "Responsable contentieux locatif", "Responsable d√©veloppement foncier", "Responsable immobilier", "Technicien diagnostic immobilier"],
            "Industrie": ["Aff√ªteur", "Agent de conditionnement", "Agent de fabrication", "Agent de finition", "Agent de production", "Agent technique", "Agent technique polyvalent", "Ajusteur", "Ajusteur a√©ronautique", "Ajusteur mouliste", "Assembleur monteur", "Assistant qualit√©", "Auditeur qualit√©", "Bobinier", "Calculateur", "Cariste", "Carrossier", "Charg√© de mission qualit√©", "Chef d'atelier", "Chef d'√©quipe maintenance", "Chef de projet industriel", "Chef de projet production", "Conditionneur", "Conducteur de four", "Conducteur de ligne", "Conducteur de ligne industrie pharmaceutique", "Conducteur de machine", "Dessinateur industriel", "Dessinateur projeteur cao", "Dessinateur-projeteur", "Directeur R&D", "Directeur de production", "Directeur de site", "Directeur industriel", "Directeur qualit√©", "Directeur usine", "Drapeur", "D√©colleteur", "Ebarbeur", "Electricien industriel", "Electrotechnicien", "Erodeur", "Fraiseur", "Ing√©nieur calcul de structures", "Ing√©nieur de production", "Ing√©nieur de projet", "Ing√©nieur industrialisation", "Ing√©nieur maintenance", "Ing√©nieur m√©tallurgiste", "Ing√©nieur m√©trologue", "Ing√©nieur planning", "Ing√©nieur p√©trolier", "Ing√©nieur qse", "Ing√©nieur qualit√©", "Ing√©nieur soudage", "Inspecteur qualit√©", "Metteur au point", "Monteur de meubles", "Monteur-c√¢bleur", "Mouleur", "M√©canicien de maintenance", "M√©tallier", "M√©trologue", "Op√©rateur de production", "Op√©rateur salle blanche", "Ordonnanceur", "Outilleur", "Outilleur mouliste", "Ouvrier abattoir", "Ouvrier de production", "Oxycoupeur", "Peintre automobile", "Peintre industriel", "Planificateur", "Plasturgiste", "Plieur cn", "Programmeur CFAO", "Qualiticien", "Rectifieur", "Responsable atelier", "Responsable bureau d'√©tudes", "Responsable contr√¥le qualit√©", "Responsable de maintenance", "Responsable de production", "Responsable de site", "Responsable fonderie", "Responsable m√©thodes", "Responsable planification", "Responsable qualit√©", "Responsable uap", "R√©gleur", "Soudeur", "Soudeur aluminium", "Stratifieur", "Superviseur de maintenance", "Technicien assurance qualit√©", "Technicien automaticien", "Technicien bureau d'√©tudes", "Technicien controle qualit√©", "Technicien d'√©tudes", "Technicien de fabrication", "Technicien de maintenance", "Technicien de maintenance industrielle", "Technicien de maintenance itin√©rant", "Technicien essai", "Technicien fonderie", "Technicien industrialisation", "Technicien instrumentation", "Technicien qualit√©", "Technicien √©lectronicien", "Technicien √©lectrotechnique", "Tourneur", "Usineur"],
            "Informatique": ["Administrateur Linux", "Administrateur SAP", "Administrateur Sharepoint", "Administrateur Windows", "Administrateur base de donn√©es", "Administrateur syst√®mes", "Administrateur unix", "Analyste d'exploitation", "Analyste developpeur", "Analyste-programmeur", "Architecte Java", "Architecte SI", "Architecte informatique", "Architecte logiciel", "Architecte r√©seau", "Architecte technique", "Chef de projet .NET", "Chef de projet AMOA", "Chef de projet Java", "Chef de projet MOA", "Chef de projet MOE", "Chef de projet d√©cisionnel", "Chef de projet erp", "Chef de projet fonctionnel", "Chef de projet informatique", "Chef de projet infrastructure", "Chef de projet mobile", "Chef de projet technique", "Chef de projet web", "Concepteur designer", "Consultant AMOA", "Consultant SAP", "Consultant SEO", "Consultant SIRH", "Consultant S√©curit√©", "Consultant fonctionnel", "Consultant informatique", "Coordinateur informatique", "Data Scientist", "Developpeur full stack", "Directeur informatique", "D√©veloppeur .NET", "D√©veloppeur Android", "D√©veloppeur C", "D√©veloppeur C++", "D√©veloppeur Flash", "D√©veloppeur Java", "D√©veloppeur PHP", "D√©veloppeur Python", "D√©veloppeur SQL", "D√©veloppeur VBA", "D√©veloppeur back end", "D√©veloppeur front end", "D√©veloppeur informatique", "D√©veloppeur logiciel", "Electronicien", "Expert s√©curit√©", "Formateur informatique", "G√©omaticien", "IT manager", "Informaticien", "Ingenieur devops", "Ing√©nieur Unix", "Ing√©nieur commercial informatique", "Ing√©nieur d√©cisionnel", "Ing√©nieur d√©veloppeur", "Ing√©nieur informatique", "Ing√©nieur logiciel", "Ing√©nieur poste de travail", "Ing√©nieur support", "Ing√©nieur syst√®me", "Ing√©nieur s√©curit√©", "Ing√©nieur traitement du signal", "Int√©grateur web", "Motion designer", "Programmeur informatique", "Pupitreur", "Scrum master", "Technicien de maintenance informatique", "Technicien de support", "Technicien exploitation informatique", "Technicien helpdesk", "Technicien support informatique", "Webdesigner"],
            "Ing√©nierie": ["Acousticien", "Automaticien", "Charg√© d'affaires cvc", "Chaudronnier naval", "Dessinateur cvc", "Hydraulicien", "Ing√©nieur G√©nie des proc√©d√©s", "Ing√©nieur R&D", "Ing√©nieur acoustique", "Ing√©nieur automaticien", "Ing√©nieur automobile", "Ing√©nieur a√©ronautique", "Ing√©nieur calcul", "Ing√©nieur contr√¥le commande", "Ing√©nieur de recherche", "Ing√©nieur eau", "Ing√©nieur en optique", "Ing√©nieur g√©nie civil", "Ing√©nieur laser", "Ing√©nieur math√©matiques appliqu√©es", "Ing√©nieur mat√©riaux", "Ing√©nieur micro √©lectronique", "Ing√©nieur mod√©lisation", "Ing√©nieur m√©canique des fluides", "Ing√©nieur m√©catronique", "Ing√©nieur m√©thodes", "Ing√©nieur nucl√©aire", "Ing√©nieur proc√©d√©s", "Ing√©nieur robotique", "Ing√©nieur simulation num√©rique", "Ing√©nieur s√ªret√©", "Ing√©nieur √©lectricit√©", "Ing√©nieur √©lectronique", "Metteur au point climatisation", "Projeteur vrd", "Roboticien", "Technicien a√©ronautique", "Technicien courant faible", "Technicien cvc", "Technicien domotique"],
            "Logistique": ["Affr√©teur", "Agent de logistique", "Agent de quai", "Agent de transit", "Analyste logistique", "Approvisionneur", "Assistant approvisionnement", "Assistant d'exploitation", "Assistant import export", "Assistant logistique", "Chef de d√©p√¥t", "Chef de projet logistique", "Conducteur routier", "Conducteur routier pl", "Conducteur routier spl", "Consultant supply chain", "Coordinateur logistique", "Coursier", "Directeur logistique", "Directeur supply chain", "Dispatcheur", "Gestionnaire de parc automobile", "Gestionnaire de stocks", "Ing√©nieur logistique", "Inventoriste", "Logisticien", "Magasinier", "Manutentionnaire", "Op√©rateur logistique", "Pilote de flux", "Pr√©parateur de commande", "Responsable de quai", "Responsable exploitation", "Responsable export", "Responsable exp√©ditions", "Responsable logistique", "Responsable magasinier", "Responsable transit", "R√©ceptionnaire", "Technicien logistique", "gestionnaire de flux"],
            "Marketing": ["Analyste de donn√©es", "Assistant chef de produit marketing", "Assistant chef de projet marketing", "Assistant marketing", "Bid manager", "Brand manager", "Category manager", "Charg√© d'√©tudes marketing", "Charg√© d'√©tudes statistiques", "Charg√© de marketing", "Chef de produit", "Chef de projet marketing", "Chef de projet web marketing", "Concepteur r√©dacteur", "Coordinateur Marketing", "Designer", "Directeur artistique", "Directeur de client√®le", "Directeur marketing", "Distributeur", "Enqu√™teur sondage", "Enqu√™teur terrain", "Pan√©liste", "Responsable marketing", "Responsable marketing op√©rationnel", "Responsable trade marketing", "Responsable web marketing", "Traffic manager"],
            "M√©canique": ["Aide m√©canicien", "Ascensoriste", "Chef atelier automobile", "Chef m√©canicien", "Contr√¥leur technique automobile", "Dessinateur m√©canique", "D√©panneur remorqueur", "Electricien automobile", "Electrom√©canicien", "Ingenieur conception mecanique", "Ing√©nieur en g√©nie m√©canique", "Ing√©nieur m√©canique", "Monteur m√©canique", "M√©canicien automobile", "M√©canicien monteur", "M√©canicien moto", "M√©canicien motoculture", "M√©canicien outilleur", "M√©canicien poids lourds", "Projeteur m√©canique", "Pr√©parateur automobile", "Responsable carrosserie", "Technicien automobile", "Technicien d'atelier"],
            "M√©dias": ["Cadreur monteur", "Chef de rubrique", "Graphiste PAO", "Graphiste designer", "Graphiste multim√©dias", "Infographiste multim√©dias", "Journaliste", "Maquettiste", "Massicotier", "Monteur vid√©o", "Relecteur-correcteur", "Reporter", "R√©dacteur en chef", "R√©dacteur pigiste", "R√©dacteur scientifique", "Secr√©taire de r√©daction", "S√©rigraphe"],
            "Petite enfance": ["ATSEM", "Agent service cr√®che", "Aide-√©ducateur", "Animateur centre loisirs", "Animateur enfants", "Animateur p√©riscolaire", "Assistante maternelle", "Auxiliaire cr√®che", "Auxiliaire petite enfance", "Directeur de centre de loisirs", "Directeur de cr√®che", "Infirmier cr√®che", "Pu√©riculteur"],
            "Physique": ["Animateur tennis", "Physicien"],
            "Propret√©": ["Agent de nettoyage", "Agent de propret√©", "Agent maintenance b√¢timent", "Employ√© de nettoyage", "Laveur de vitres", "Ouvrier d'entretien"],
            "Ressources humaines": ["Assistant recrutement", "Assistant ressources humaines", "Charg√© de mission RH", "Charg√© de recrutement", "Charg√© de ressources humaines", "Chef de projet Ressources Humaines", "Chef de projet SIRH", "Chef du personnel", "Chief happiness officer", "Collaborateur social", "Conseiller formation", "Consultant en recrutement", "Consultant en ressources humaines", "Consultant management", "Contr√¥leur de gestion sociale", "Directeur des ressources humaines", "Ergonome", "Gestionnaire RH", "Gestionnaire de paie", "Gestionnaire du personnel", "Knowledge manager", "Lean manager", "Project management officer", "Responsable Administration Du Personnel", "Responsable des ressources humaines", "Responsable formation", "Responsable paie", "Responsable relations sociales", "Team leader"],
            "Restauration": ["Agent de restauration", "Aide-cuisinier", "Barman", "Chef cuisinier", "Chef de partie", "Chef de rang", "Chef de secteur CHR", "Chef g√©rant", "Chef p√¢tissier", "Commis de cuisine", "Commis de salle", "Cr√™pier", "Cuisinier", "Cuisinier de collectivit√©", "Directeur de restaurant", "Employ√© polyvalent de restauration", "Grillardin", "Livreur de pizzas", "Manager en restauration", "Ma√Ætre d'h√¥tel", "Oenologue", "Plongeur", "P√¢tissier", "Responsable de cuisine", "Responsable de salle", "Responsable en restauration", "Second de cuisine", "Serveur", "Serveur barman", "Serveur extra", "Sommelier"],
            "Sant√©": ["ASH - Agent de services hospitaliers", "Agent de service maison de retraite", "Agent de st√©rilisation", "Aide-soignant", "Ambulancier", "Anesth√©siste", "Assistant dentaire", "Assistant m√©dical", "Assistant v√©t√©rinaire", "Attach√© de recherche clinique", "Audioproth√©siste", "Auxiliaire ambulancier", "Auxiliaire de pu√©riculture", "Biostatisticien", "Brancardier", "Cadre de sant√©", "Cadre infirmier", "Cadre sup√©rieur de sant√©", "Cardiologue", "Chef de bloc", "Chef de service", "Chirurgien", "Chirurgien orthop√©dique", "Dentiste", "Dermatologue", "Directeur d'EHPAD", "Directeur d'√©tablissement de sant√©", "Directeur des soins", "Directeur m√©dico-social", "Di√©t√©ticien", "Endocrinologue", "Ergoth√©rapeute", "Gastro-ent√©rologue", "Gyn√©cologue", "Infirmier", "Infirmier anesth√©siste", "Infirmier auxiliaire", "Infirmier bloc op√©ratoire", "Infirmier coordinateur", "Infirmier dialyse", "Infirmier du secteur psychiatrique", "Infirmier ehpad", "Infirmier m√©decine du travail", "Infirmier urgences", "Infirmi√®re en entreprise", "Infirmi√®re lib√©rale", "Kin√©sith√©rapeute", "Manipulateur en radiologie", "Masseur kin√©sith√©rapeute", "M√©decin coordinateur", "M√©decin du travail", "M√©decin g√©n√©raliste", "M√©decin g√©riatre", "M√©decin urgentiste", "Neurochirurgien", "Neurologue", "Neuropsychologue", "Nutritionniste", "N√©phrologue", "Oncologue", "Ophtalmologue", "Optom√©triste", "Orthophoniste", "Ost√©opathe", "Pharmacien", "Pharmacien affaires r√©glementaires", "Pharmacien biologiste", "Pharmacien hospitalier", "Pharmacien qualit√©", "Pneumologue", "Podologue", "Professeur de yoga", "Pr√©parateur en pharmacie", "Psychiatre", "Psychologue", "Psychologue clinicien", "Psychologue du travail", "Psychomotricien", "P√©diatre", "Radiologue", "Sage-femme", "Secr√©taire dentaire", "Sophrologue", "Technicien biom√©dical", "Urologue", "Visiteur m√©dical", "V√©t√©rinaire"],
            "Secr√©tariat": ["Assistant secr√©taire", "Secr√©taire", "Secr√©taire administratif", "Secr√©taire bilingue", "Secr√©taire commercial", "Secr√©taire de direction", "Secr√©taire m√©dicale", "T√©l√©secr√©taire"],
            "S√©curit√©": ["Agent cynophile s√©curit√©", "Agent de surveillance", "Agent de s√©curit√©", "Agent de s√©curit√© incendie", "Animateur s√©curit√©", "Convoyeur de fonds", "D√©tective", "Garde du corps", "Gardien", "Gardien de la paix", "Gendarme", "Op√©rateur t√©l√©surveillance", "Pilote de drones", "Responsable s√©curit√©", "Sapeur-Pompier", "Secouriste"],
            "Service client√®le": ["Agent d'accueil", "Assistant personnel", "Etalagiste", "Hotliner", "P√®re No√´l", "R√©dacteur technique", "Technicien SAV", "Technicien √©lectrom√©nager", "Toiletteur"],
            "Services √† la personne": ["Aide m√©nag√®re √† domicile", "Aide √† domicile", "Baby sitter", "Chef d'√©quipe propret√©", "Coach professionnel", "Coiffeur", "Concierge", "D√©m√©nageur", "Employ√© familial", "Employ√© pressing", "Esth√©ticien", "Femme de m√©nage", "Garde d'animaux", "Gardien d'immeuble", "Maquilleur", "Repasseur", "Thanatopracteur"],
            "Social": ["Aide m√©dico-psychologique", "Animateur maison retraite", "Assistant de service social", "Auxiliaire de vie sociale - AVS", "Conseiller en insertion professionnelle", "Conseiller en √©conomie sociale et familiale", "Conseiller social", "Coordinateur social", "Directeur ESAT", "Directeur adjoint ESAT", "Educateur", "Intervenant action sociale", "Moniteur d'atelier", "Moniteur √©ducateur", "√âducateur sp√©cialis√©"],
            "T√©l√©communications": ["Administrateur r√©seau", "Ing√©nieur radio", "Ing√©nieur r√©seau", "Ing√©nieur t√©l√©com", "Piqueteur", "Technicien fibre optique", "Technicien r√©seau", "ing√©nieur hyperfr√©quences"],
            "Tourisme": ["Accompagnateur montagne", "Accompagnateur tourisme √©questre", "Agent de comptoir", "Agent de d√©veloppement touristique", "Agent de r√©servation", "Agent de voyage", "Animateur tourisme", "Animateur village vacances", "Billettiste", "Conseiller voyages", "Directeur centre de vacances", "Forfaitiste", "Guide touristique", "Moniteur de ski", "Responsable animation", "Spa manager"],
            "Transport": ["Agent a√©roportuaire", "Agent d'escale", "Agent d'exploitation transport et logistique", "Agent de piste", "Agent de trafic a√©rien", "Agent s√ªret√© a√©roportuaire", "Architecte naval", "Bagagiste", "Chauffeur VTC", "Chauffeur d'autocar", "Chauffeur de bus", "Chauffeur de direction", "Chauffeur de taxi", "Chauffeur livreur", "Chauffeur priv√©", "Chauffeur routier", "Chef de quart", "Contr√¥leur a√©rien", "Convoyeur de v√©hicules", "Directeur transport", "Docker", "D√©clarant en douanes", "Formateur conduite", "H√¥tesse de l'air", "Ing√©nieur a√©rodynamique", "Ing√©nieur signalisation ferroviaire", "Magasinier a√©ronautique", "Monteur de pneus", "M√©canicien a√©ronautique", "Pilote d'avion", "Pilote d'h√©licopt√®re", "Responsable transport"],
            "Vente": ["Assistant administration des ventes", "Caissier", "Chef des ventes r√©gional", "Concepteur vendeur", "Conseiller beaut√©", "Coordinateur des ventes", "Directeur de filiale", "D√©l√©gu√© pharmaceutique", "Formateur vente", "Gestionnaire administration des ventes", "Manager des ventes", "Product owner", "Pr√©visionniste des ventes", "Responsable administration des ventes", "Responsable boutique", "Responsable commercial automobile", "Responsable de caisse", "Responsable de magasin", "Responsable de secteur", "Responsable parapharmacie", "Responsable t√©l√©vente", "T√©l√© prospecteur", "T√©l√©vendeur", "Vendeur", "Vendeur animalerie", "Vendeur automobile", "Vendeur jeux video", "Vendeur moto", "Vendeur multim√©dia"]
        };

        // --- 2. MAP DES FILI√àRES ---
        const STREAM_MAP = {
            "SC_Maths": ["Ing√©nierie", "Informatique", "Physique", "Chimie", "Architecture", "Industrie", "Math√©matiques"],
            "SC_Exp": ["Sant√©", "Environnement", "Agricole", "Chimie"],
            "STEG": ["Btp", "M√©canique", "Industrie", "Ing√©nierie"],
            "EG": ["Commerce", "Vente", "Banque", "Finance", "Comptabilit√©", "Gestion", "Marketing", "Digital", "Administration"],
            "SH": ["Enseignement", "Social", "Ressources humaines", "S√©curit√©", "Administration", "Services √† la personne"],
            "LP": ["Enseignement", "Droit", "Culture", "M√©dias", "Communication", "H√¥tellerie", "Tourisme", "Artisanat"]
        };

        // --- 3. TAGS MAP ---
        const TAG_MAP = {
            "Sant√©": ["bio", "social", "soin"],
            "Btp": ["manuel", "technique", "logique"],
            "Informatique": ["tech", "logique", "code"],
            "Industrie": ["technique", "manuel", "usine"],
            "M√©canique": ["technique", "manuel", "logique"],
            "Ing√©nierie": ["science", "logique", "maths"],
            "Commerce": ["vente", "contact", "eco"],
            "Vente": ["vente", "contact", "commerce"],
            "Banque": ["finance", "eco", "maths"],
            "Finance": ["finance", "eco", "maths"],
            "Comptabilit√©": ["admin", "maths", "eco"],
            "Gestion": ["admin", "eco", "management"],
            "Droit": ["lettre", "droit", "justice"],
            "Architecture": ["arts", "logique", "design"],
            "Artisanat": ["manuel", "arts", "creation"],
            "Culture": ["arts", "creation", "lettre"],
            "Enseignement": ["social", "lettre", "science"],
            "Social": ["social", "soin", "humain"],
            "Ressources humaines": ["social", "admin", "droit"],
            "Transport": ["manuel", "logistique", "conducteur"],
            "Logistique": ["manuel", "organisation", "logistique"],
            "H√¥tellerie": ["contact", "service", "social"],
            "Restauration": ["manuel", "service", "creation"],
            "Environnement": ["bio", "nature", "science"],
            "Agricole": ["bio", "nature", "manuel"],
            "S√©curit√©": ["manuel", "social", "ordre"],
            "Marketing": ["creation", "commerce", "eco"],
            "Communication": ["creation", "media", "lettre"],
            "M√©dias": ["creation", "media", "lettre"],
            "Digital": ["tech", "creation", "code"],
            "Immobilier": ["commerce", "logique", "patrimoine"],
            "Administration": ["admin", "secretariat", "org"],
            "Secr√©tariat": ["admin", "secretariat", "org"],
            "Services √† la personne": ["social", "manuel", "service"],
            "Propret√©": ["manuel", "service", "hygiene"],
            "Achat": ["commerce", "organisation", "n√©gociation"],
            "Grande distribution": ["commerce", "service", "stock"],
            "Tourisme": ["contact", "service", "culture"],
            "Alimentation": ["manuel", "creation", "hygiene"],
            "Chimie": ["science", "labo", "bio"],
            "Physique": ["science", "maths", "recherche"],
            "Economie": ["eco", "maths", "analyse"],
            "Am√©nagement": ["urbanisme", "nature", "design"],
            "Emploi public": ["admin", "social", "service"],
            "Petite enfance": ["social", "soin", "education"]
        };

        // --- 4. DESCRIPTIONS SP√âCIFIQUES ---
        const CUSTOM_DESC = {
            "M√©decin": "M√©decin g√©n√©raliste ou sp√©cialiste qui diagnostique et traite les maladies.",
            "Infirmier": "Personnel soignant qui r√©alise les soins m√©dicaux et assure le confort des patients.",
            "Avocat": "Juriste qui conseille et d√©fend ses clients devant les tribunaux.",
            "Architecte": "Professionnel qui con√ßoit la structure et l'esth√©tique des b√¢timents.",
            "D√©veloppeur web": "Ing√©nieur logiciel qui cr√©e des sites internet et des applications web.",
            "Ing√©nieur": "Professionnel hautement qualifi√© qui con√ßoit des solutions techniques.",
            "Comptable": "Sp√©cialiste de la gestion financi√®re qui enregistre les flux et assure la fiscalit√©.",
            "Ma√ßon": "Ouvrier du BTP sp√©cialis√© dans la construction de murs et structures.",
            "Plombier": "Technicien qui installe et r√©pare les r√©seaux d'eau.",
            "√âlectricien": "Technicien qui r√©alise l'installation des circuits √©lectriques.",
            "Professeur": "Enseignant qui transmet des connaissances dans un √©tablissement scolaire.",
            "Policier": "Agent de l'√âtat charg√© de maintenir l'ordre public.",
            "Pilote d'avion": "Professionnel charg√© de piloter un a√©ronef.",
            "Chef de projet": "Responsable qui coordonne les ressources d'un projet pour atteindre les objectifs.",
            "Journaliste": "Professionnel de l'information qui r√©dige des articles sur l'actualit√©."
        };

        // --- 5. LEVEL MAP ---
        const LEVEL_MAP = {
            "3AC": ["3√®me Ann√©e Coll√®ge"],
            "TC": ["Tronc Commun"],
            "1BAC": ["1√®re Bac"],
            "2BAC": ["2√®me Bac"],
        };

        // --- 6. DONN√âES PARCOURS TIMELINE ---
        const PATHS_DATA = {
            "M√©decin": {
                main: [
                    { year: "Baccalaur√©at", target: "FMP (1√®re Ann√©e Commune)", desc: "Obtenir le Bac Scientifique avec bonne moyenne." },
                    { year: "FMP", target: "CNA (Concours National d'Acc√®s)", desc: "1 ann√©e universitaire commune (SVT/BCP)." },
                    { year: "1er Cycle (2 ans)", target: "Externat ou Internat", desc: "Formation sciences fondamentales (anatomie, physiologie, biochimie)." },
                    { year: "2√®me Cycle (3 ans)", target: "Stages cliniques", desc: "Enseignements th√©oriques avanc√©s et stages cliniques externes." },
                    { year: "3√®me cycle (1 ans)", target: "Th√®se de M√©decine", desc: "Stages cliniques √† plein temps et soutenance de th√®se." }
                ],
                alternatives: [
                    { condition: "Si √©chec au CNA", path: ["Option: R√©p√©ter l'ann√©e suivante.", "Option: M√©decine √† l'√©tranger.", "Option: Pharmacie ou Dentaire si rang suffisant."] }
                ]
            },
            "Ing√©nieur": {
                main: [
                    { year: "Baccalaur√©at", target: "CPGE (Classes Pr√©paratoires)", desc: "Bac Sciences Maths." },
                    { year: "CPGE (2 ans)", target: "CNC (Concours National Commun)", desc: "MPSI, PTSI, ou TSI." },
                    { year: "Grande √âcole", target: "Cycle Ing√©nieur (3 ans)", desc: "ENSA, ENSEM, ENIM, ENA..." }
                ],
                alternatives: [
                    { condition: "Si √©chec au BAC", path: ["Option: Redoubler.", "Option: OFPPT (TS M√©canique/√âlectricit√©)."] }
                ]
            },
            "Avocat": {
                main: [
                    { year: "Baccalaur√©at", target: "Facult√© de Droit", desc: "Licence de Droit Priv√© ou Public." },
                    { year: "Licence (3 ans)", target: "Master (2 ans)", desc: "Sp√©cialisation en Droit des Affaires, Fiscalit√© ou Justice." },
                    { year: "Master", target: "IEA (Institut d'√âtudes Judiciaires)", desc: "Stage de 18 mois obligatoire." },
                    { year: "Serment", target: "Avocat au Barreau", desc: "Prestation de serment et d√©but de carri√®re." }
                ],
                alternatives: []
            },
            "default": {
                main: [
                    { year: "Baccalaur√©at", target: "Enseignement Sup√©rieur", desc: "Choisir une formation adapt√©e √† la fili√®re." }
                ],
                alternatives: []
            }
        };

        // --- 7. NOTIFICATIONS (TOASTS) ---
        const showToast = (message, type = 'success') => {
            let container = document.querySelector('.toast-container');
            if(!container) {
                container = document.createElement('div');
                container.className = 'toast-container';
                document.body.appendChild(container);
            }
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `<span>${message}</span>`;
            container.appendChild(toast);
            setTimeout(() => { toast.style.opacity = '0'; toast.style.transform = 'translateY(20px)'; }, 3000);
            setTimeout(() => { toast.remove(); }, 3500);
        };

        // --- 8. APPLICATION CORE ---
        const app = {
            jobs: [],
            user: null,
            quizScores: {},
            questions: [],
            currentQ: 0,
            scores: {},

            // === GESTION DU TH√àME ===
            toggleTheme: function() {
                this.isDarkMode = !this.isDarkMode;
                document.documentElement.setAttribute('data-theme', this.isDarkMode ? 'dark' : 'light');
                // Le CSS g√®re d√©sormais l'animation et l'affichage des ic√¥nes
                // Pas besoin de modifier innerText ici
            },

            // === NAVIGATION MOBILE ===
            toggleMenu: function() {
                const nav = document.getElementById('mobileNav');
                const overlay = document.getElementById('mobileOverlay');
                if(nav.classList.contains('open')) {
                    nav.classList.remove('open');
                    overlay.classList.remove('open');
                } else {
                    nav.classList.add('open');
                    overlay.classList.add('open');
                }
            },

            // === INITIALIZATION ===
            init: function() {
                this.processData();
                this.loadUser();
                this.renderFilters();
                if(this.user && this.user.name) this.navigate('dashboard');
                else this.navigate('onboarding');
            },

            processData: function() {
                let idCounter = 1;
                this.jobs = [];
                for (const [category, jobList] of Object.entries(RAW_DATA)) {
                    jobList.forEach(jobTitle => {
                        const tags = TAG_MAP[category] || ["general"];
                        const description = CUSTOM_DESC[jobTitle] || `Professionnel dans le secteur ${category}. Ce m√©tier n√©cessite des comp√©tences vari√©es.`;
                        this.jobs.push({ id: idCounter++, title: jobTitle, category: category, description: description, tags: tags });
                    });
                }
                const totalJobsEl = document.getElementById('totalJobsCount');
                const totalCatsEl = document.getElementById('totalCatsCount');
                if(totalJobsEl) totalJobsEl.textContent = this.jobs.length;
                if(totalCatsEl) totalCatsEl.textContent = Object.keys(RAW_DATA).length;
            },

            getHollandQuestions: function() {
                return [
                    { text: "Aimes-tu travailler avec des outils et des machines ?", type: "R" },
                    { text: "Aimes-tu r√©soudre des probl√®mes math√©matiques complexes ?", type: "I" },
                    { text: "Aimes-tu dessiner, √©crire ou cr√©er des choses artistiques ?", type: "A" },
                    { text: "Aimes-tu aider et enseigner les autres ?", type: "S" },
                    { text: "Aimes-tu vendre des produits ou persuader les gens ?", type: "E" },
                    { text: "Aimes-tu organiser des donn√©es et suivre des proc√©dures ?", type: "C" },
                    { text: "Pr√©f√®res-tu travailler √† l'ext√©rieur ?", type: "concret" },
                    { text: "Est-ce que tu aimes travailler seul sans supervision ?", type: "autonomie" },
                    { text: "Est-ce que tu aimes diriger une √©quipe ?", type: "encadrement" },
                    { text: "Est-ce que tu pr√©f√®res les t√¢ches manuelles ?", type: "manuel" }
                ];
            },

            comparator: {
                data: {
                    "sc_maths": { label: "Sciences Maths", difficulty:5, math: 5, load: 5, duration: "5 √† 7 ans", jobs: ["Ing√©nieur", "Architecte", "Chercheur", "Data Scientist"], market: "Tr√®s porteur", profile: "Logique d√©velopp√©e, excellence en maths." },
                    "sc_exp": { label: "Sciences Exp√©rimentales", difficulty: 3, math: 3, load: 4, duration: "6 √† 8 ans", jobs: ["M√©decin", "Pharmacien", "Biologiste"], market: "Sant√© stable", profile: "Int√©r√™t pour les sciences de la vie." },
                    "eco": { label: "√âconomie & Gestion", difficulty: 3, math: 4, load: 3, duration: "4 √† 5 ans", jobs: ["Comptable", "Commercial", "Banquier"], market: "Large besoin", profile: "Aisance avec les chiffres." },
                    "lettres": { label: "Lettres & Philosophie", difficulty: 3, math: 1, load: 3, duration: "4 √† 5 ans", jobs: ["Professeur", "Journaliste", "Avocat"], market: "Enseignement, droit", profile: "Excellente expression √©crite." },
                    "univ": { label: "Universit√© (Litt√©raire/Humaines)", difficulty: 2, math: 1, load: 2, duration: "4 ans +", jobs: ["Enseignant", "Chercheur"], market: "Secteur public", profile: "Autonomie, recherche." },
                    "ecoles": { label: "√âcoles Sup√©rieures", difficulty: 5, math: 5, load: 5, duration: "5 ans", jobs: ["Ing√©nieur d'√âtat", "Chef de projet"], market: "R√©mun√©ration √©lev√©e", profile: "Bon niveau g√©n√©ral, ambition." },
                    "ofppt": { label: "OFPPT (Formation Pro)", difficulty: 2, math: 2, load: 4, duration: "2 √† 3 ans", jobs: ["Technicien", "Ouvrier qualifi√©"], market: "Besoins forts", profile: "Go√ªt pour la pratique." }
                },
                runComparison: function () {
                    const s1 = document.getElementById('streamSelect1').value;
                    const s2 = document.getElementById('streamSelect2').value;
                    const container = document.getElementById('compareResults');
                    container.innerHTML = '';
                    if (!s1 || !s2) { showToast("Veuillez s√©lectionner au moins deux options.", "error"); return; }
                    const selections = [s1, s2].filter(Boolean);
                    selections.forEach(key => {
                        const data = this.data[key];
                        if (!data) return;
                        const isMatch = window.app.user && window.app.user.stream === key;
                        const matchBadge = isMatch ? `<div style="position:absolute; top:10px; right:10px; background:var(--accent); color:var(--accent-text); padding:4px 8px; border-radius:4px; font-size:0.75rem; font-weight:bold;">‚úì Pour toi</div>` : '';
                        const html = `
                            <div class="card" style="position:relative; border-top: 4px solid ${isMatch ? 'var(--accent)' : 'var(--primary)'};">
                                ${matchBadge}
                                <h3 style="color:var(--primary); margin-bottom:15px;">${data.label}</h3>
                                <ul style="margin-bottom:15px; padding-left:20px; color:var(--text-muted);">
                                    <li><strong>Dur√©e :</strong> ${data.duration}</li>
                                    <li><strong>D√©bouch√©s :</strong> ${data.market}</li>
                                </ul>
                                <div style="margin-bottom:10px;">
                                    <div style="display:flex; justify-content:space-between; font-size:0.85rem; margin-bottom:5px;"><span>Difficult√©</span><span>${data.difficulty}/5</span></div>
                                    <div class="progress-bar-bg"><div class="progress-bar-fill" style="width:${data.difficulty * 20}%"></div></div>
                                </div>
                                <div>
                                    <div style="display:flex; justify-content:space-between; font-size:0.85rem; margin-bottom:5px;"><span>Maths</span><span>${data.math}/5</span></div>
                                    <div class="progress-bar-bg"><div class="progress-bar-fill" style="width:${data.math * 20}%"></div></div>
                                </div>
                            </div>
                        `;
                        container.innerHTML += html;
                    });
                }
            },

            navigate: function (pageId) {
                document.querySelectorAll('section').forEach(el => el.classList.remove('active'));
                const page = document.getElementById(pageId);
                if (page) {
                    page.classList.add('active');
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    if (pageId === 'dashboard' && this.user) this.renderDashboard();
                    if (pageId === 'jobs') this.filterJobs('all');
                }
            },

            toggleStream: function () {
                const lvl = document.getElementById('level').value;
                const grp = document.getElementById('streamGroup');
                grp.style.display = (lvl === '1BAC' || lvl === '2BAC') ? 'block' : 'none';
            },

            saveProfile: function (e) {
                e.preventDefault();
                const name = document.getElementById('name').value;
                let level = document.getElementById('level').value;
                const stream = document.getElementById('stream').value || '';
                if (!name || !level) { showToast("Veuillez remplir tous les champs !", "error"); return; }
                try {
                    localStorage.setItem('user_profile', JSON.stringify({ name, level, stream }));
                    this.user = { name, level, stream };
                    document.getElementById('uName').textContent = name;
                    showToast(`Bienvenue ${name} !`);
                    this.navigate('dashboard');
                } catch (error) {
                    showToast("Erreur sauvegarde.", "error");
                }
            },

            loadUser: function () {
                try {
                    const stored = localStorage.getItem('user_profile');
                    this.user = stored ? JSON.parse(stored) : null;
                } catch (e) { this.user = null; }
            },

            logout: function () {
                localStorage.removeItem('user_profile');
                this.user = null;
                document.getElementById('name').value = '';
                document.getElementById('level').value = '';
                document.getElementById('stream').value = '';
                this.navigate('onboarding');
                showToast("Vous avez √©t√© d√©connect√©.");
            },

            renderDashboard: function () {
                const random = [...this.jobs].sort(() => 0.5 - Math.random()).slice(0, 3);
                const container = document.getElementById('featuredJobs');
                if (container) container.innerHTML = random.map(j => this.createJobCard(j)).join('');
            },

            renderFilters: function () {
                const select = document.getElementById('categoryFilter');
                if (!select) return;
                select.innerHTML = '<option value="all">Toutes les cat√©gories</option>';
                Object.keys(RAW_DATA).sort().forEach(c => {
                    const opt = document.createElement('option');
                    opt.value = c;
                    opt.textContent = c;
                    select.appendChild(opt);
                });
            },

            filterJobs: function (category) {
                const container = document.getElementById('jobsList');
                if (!container) return;
                const searchValue = document.getElementById('jobSearch') ? document.getElementById('jobSearch').value.toLowerCase() : "";
                let filtered = this.jobs;
                if (category !== 'all') filtered = filtered.filter(j => j.category === category);
                if (searchValue.length > 0) filtered = filtered.filter(j => j.title.toLowerCase().includes(searchValue) || j.category.toLowerCase().includes(searchValue));
                
                container.innerHTML = filtered.map(j => this.createJobCard(j)).join('');
                const countSpan = document.getElementById('currentCount');
                if (countSpan) countSpan.textContent = filtered.length;
            },

            createJobCard: function (job) {
                return `
                    <div class="job-card" onclick="window.app.showJob(${job.id})">
                        <div class="job-header">
                            <div class="job-title">${job.title}</div>
                            <span class="job-category">${job.category}</span>
                        </div>
                        <div class="job-body">
                            ${job.description.substring(0, 80)}...
                        </div>
                    </div>
                `;
            },

            showJob: function (id) {
                const job = this.jobs.find(j => j.id === id);
                if (!job) return;

                const pathData = PATHS_DATA[job.title] || PATHS_DATA.default;
                const userLevel = this.user ? this.user.level : null;

                let timelineHTML = `<div class="timeline">`;
                pathData.main.forEach((step) => {
                    let isCurrent = false;
                    if (userLevel && LEVEL_MAP[userLevel]) {
                        if (LEVEL_MAP[userLevel][0].includes(step.year) || step.year.includes(LEVEL_MAP[userLevel][0])) isCurrent = true;
                    }
                    const activeClass = isCurrent ? 'is-current' : '';
                    timelineHTML += `
                        <div class="timeline-item ${activeClass}">
                            <div class="timeline-dot"></div>
                            <div class="timeline-content">
                                <span style="font-weight:bold; color:var(--primary); display:block;">${step.year}</span>
                                <span style="display:block; margin-bottom:5px;">${step.target}</span>
                                <p style="font-size:0.9rem; color:var(--text-muted);">${step.desc}</p>
                            </div>
                        </div>
                    `;
                });
                timelineHTML += `</div>`;

                let altsHTML = '';
                if (pathData.alternatives && pathData.alternatives.length > 0) {
                    altsHTML = `<div style="margin-top:20px; background:rgba(255, 193, 7, 0.1); padding:15px; border-radius:var(--radius-sm); border-left:4px solid var(--accent);">
                        <h5 style="color:#E65100; margin-bottom:10px;">üõ°Ô∏è Alternatives</h5>`;
                    pathData.alternatives.forEach(alt => {
                        altsHTML += `<div style="margin-bottom:10px;"><strong>${alt.condition}</strong><br/><span style="font-size:0.9rem;">${Array.isArray(alt.path) ? alt.path.join(' / ') : alt.path}</span></div>`;
                    });
                    altsHTML += `</div>`;
                }

                const modalBody = document.getElementById('modalBody');
                if (modalBody) {
                    modalBody.innerHTML = `
                        <div style="display:flex; justify-content:space-between; align-items:start; margin-bottom:20px;">
                            <div>
                                <h2 style="color:var(--primary); line-height:1.2;">${job.title}</h2>
                                <span style="background:var(--secondary); color:white; padding:4px 10px; border-radius:4px; font-size:0.75rem; text-transform:uppercase;">${job.category}</span>
                            </div>
                        </div>
                        <p style="margin-bottom:20px; line-height:1.6;">${job.description}</p>
                        
                        <div style="margin-bottom:20px;">
                            <strong>Comp√©tences cl√©s :</strong>
                            <div style="display:flex; gap:5px; flex-wrap:wrap; margin-top:5px;">
                                ${job.tags.map(t => `<span style="background:var(--bg-input); padding:4px 10px; border-radius:12px; font-size:0.8rem; color:var(--text-muted);">${t}</span>`).join('')}
                            </div>
                        </div>

                        <details style="background:var(--bg-input); border-radius:var(--radius-sm); overflow:hidden;">
                            <summary style="padding:15px; cursor:pointer; font-weight:600; color:var(--primary);">Voir le parcours scolaire üéì</summary>
                            <div style="padding:15px; border-top:1px solid var(--border-color);">
                                ${timelineHTML}
                                ${altsHTML}
                            </div>
                        </details>
                    `;
                }
                document.getElementById('jobModal').classList.add('open');
            },

            closeModal: function () {
                document.getElementById('jobModal').classList.remove('open');
            },

            startQuiz: function () {
                this.questions = this.getHollandQuestions();
                this.scores = { R: 0, I: 0, A: 0, S: 0, E: 0, C: 0, concret: 0, abstrait: 0, autonomie: 0, encadrement: 0, manuel: 0 };
                this.currentQ = 0;
                this.navigate('quiz');
                this.renderQuestion();
            },

            renderQuestion: function () {
                if (!this.questions || this.currentQ >= this.questions.length) return;
                const q = this.questions[this.currentQ];
                const progress = Math.round(((this.currentQ) / this.questions.length) * 100);
                document.getElementById('qText').textContent = `${this.currentQ + 1}. ${q.text}`;
                document.getElementById('quizProgress').style.width = progress + '%';
                document.getElementById('quizProgressText').textContent = `${progress}%`;

                document.getElementById('qOptions').innerHTML = `
                    <button class="option-btn" onclick="window.app.answerQuiz(true)">‚úì Oui, tout √† fait</button>
                    <button class="option-btn" onclick="window.app.answerQuiz(false)">‚úó Non, pas du tout</button>
                `;
            },

            answerQuiz: function (answer) {
                if (!this.questions || this.currentQ >= this.questions.length) return;
                const q = this.questions[this.currentQ];
                if (answer) { if(this.scores[q.type] !== undefined) this.scores[q.type]++; }
                
                this.currentQ++;
                if (this.currentQ < this.questions.length) { this.renderQuestion(); } else { this.showQuizResults(); }
            },

            showQuizResults: function () {
                const riasecScores = { R: this.scores.R, I: this.scores.I, A: this.scores.A, S: this.scores.S, E: this.scores.E, C: this.scores.C };
                const riasecCode = Object.entries(riasecScores).sort((a, b) => b[1] - a[1]).slice(0, 3).map(([letter]) => letter).join("");
                const profiles = { cognitif: this.scores.concret > this.scores.abstrait ? "Concret" : "Abstrait", autonomie: this.scores.autonomie > this.scores.encadrement ? "Autonome" : "Encadr√©" };

                document.getElementById('resProfile').textContent = `Code RIASEC : ${riasecCode}`;
                document.getElementById('resStream').textContent = this.user?.stream || "√Ä d√©terminer";
                document.getElementById('resTags').innerHTML = `
                    <span style="background:var(--bg-body); padding:6px 12px; border-radius:20px; border:1px solid var(--secondary); color:var(--primary); font-weight:600;">${profiles.cognitif}</span>
                    <span style="background:var(--bg-body); padding:6px 12px; border-radius:20px; border:1px solid var(--secondary); color:var(--primary); font-weight:600;">${profiles.autonomie}</span>
                `;

                let candidateJobs = this.jobs;
                if (this.user?.stream && STREAM_MAP[this.user.stream]) {
                    const allowedCats = STREAM_MAP[this.user.stream];
                    candidateJobs = this.jobs.filter(j => allowedCats.includes(j.category));
                }
                const matches = candidateJobs.slice(0, 8);
                document.getElementById('resJobs').innerHTML = matches.map(j => this.createJobCard(j)).join('');
                this.navigate('results');
            }
        };

        window.app = app;
        document.addEventListener('DOMContentLoaded', () => { window.app.init(); });

    </script>
</body>
</html>