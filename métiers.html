<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Orientation Scolaire Maroc - Module IA Pro</title>
    <!-- Police Moderne -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- 1. VARIABLES CSS (PALETTE BLEU & BLANC PRO) --- */
        :root {
            /* Bleu Action (Boutons, Liens) */
            --primary: #0284c7;       /* Azure Blue - Tech & Trust */
            --primary-hover: #0369a1; /* Darker Azure */
            --primary-light: #f0f9ff; /* Very light blue for backgrounds */
            
            /* Textes */
            --text-main: #0f172a;     /* Dark Navy - For readability but still blue tinted */
            --text-muted: #64748b;    /* Slate Grey - For subtext */
            --text-highlight: #0ea5e9; /* Sky Blue - For accents */

            /* Surfaces */
            --bg-body: #f8fafc;       /* Very pale grey-blue background */
            --bg-surface: #ffffff;    /* Pure white cards */
            --bg-input: #f1f5f9;      /* Input background */

            /* Bordures */
            --border-color: #e2e8f0;
            --border-focus: #0284c7;

            /* √âtats */
            --success: #10b981;
            --danger: #ef4444;

            /* Forme & Ombres */
            --radius-sm: 6px;
            --radius-md: 12px;
            --radius-lg: 20px;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1);
        }

        /* --- DARK MODE (BLEU PROFOND) --- */
        [data-theme="dark"] {
            --primary: #38bdf8;       /* Bright Sky Blue for dark mode contrast */
            --primary-hover: #0ea5e9;
            --primary-light: #1e293b;

            --text-main: #f1f5f9;
            --text-muted: #94a3b8;
            --text-highlight: #7dd3fc;

            --bg-body: #0f172a;       /* Dark Navy Background */
            --bg-surface: #1e293b;   /* Lighter Navy Cards */
            --bg-input: #334155;

            --border-color: #334155;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.5);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.5);
        }

        /* --- 2. BASE & RESET --- */
        * { box-sizing: border-box; outline: none; }

        body {
            font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0;
            padding: 40px 20px;
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            transition: background-color 0.3s ease, color 0.3s ease;
        }

        /* --- 3. HEADER (D√©grad√© Bleu Pro) --- */
        header {
            max-width: 900px;
            margin: 0 auto 40px auto;
            padding: 60px 40px;
            /* D√©grad√© Bleu Marine vers Bleu Royal */
            background: linear-gradient(135deg, #0f172a 0%, #0284c7 100%);
            border-radius: var(--radius-lg);
            color: white;
            text-align: center;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* Texture subtile Header */
        header::before {
            content: '';
            position: absolute;
            top: -50%; left: -50%;
            width: 200%; height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.08) 0%, transparent 60%);
            animation: rotateBg 30s linear infinite;
            pointer-events: none;
        }
        @keyframes rotateBg { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        h1 {
            font-size: 2.5rem;
            font-weight: 800; /* Extra bold pour le titre pro */
            margin: 0;
            letter-spacing: -0.03em;
            position: relative;
            z-index: 1;
        }

        p.subtitle {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.9);
            margin-top: 12px;
            font-weight: 400;
            position: relative;
            z-index: 1;
        }

        /* --- 4. BOUTON THEME --- */
        #theme-toggle {
            position: absolute;
            top: 24px; right: 24px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 18px;
            border-radius: 50px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s ease;
            z-index: 10;
        }
        #theme-toggle:hover { background: rgba(255, 255, 255, 0.25); transform: translateY(-2px); }
        #theme-toggle svg { width: 18px; height: 18px; }

        /* --- 5. MAIN & FORM --- */
        main {
            max-width: 900px;
            margin: 0 auto;
            background: var(--bg-surface);
            padding: 48px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border-color);
            transition: background-color 0.3s ease;
        }

        .form-section {
            background: var(--primary-light); /* Fond bleu tr√®s clair */
            padding: 32px;
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color);
            margin-bottom: 40px;
        }

        .form-section h3 {
            margin-top: 0; margin-bottom: 24px;
            font-size: 1.25rem;
            color: var(--primary); /* Titre en bleu */
            font-weight: 700;
        }

        .form-group { margin-bottom: 24px; }

        label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-main); /* Label en bleu fonc√© */
            font-size: 0.9rem;
        }

        select, input[type="text"] {
            width: 100%;
            padding: 14px 16px;
            background: var(--bg-surface);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: 1rem;
            color: var(--text-main);
            transition: all 0.2s ease;
            box-shadow: var(--shadow-sm);
        }

        select:focus, input[type="text"]:focus {
            border-color: var(--border-focus);
            box-shadow: 0 0 0 3px rgba(2, 132, 199, 0.1); /* Halo bleu */
        }

        button[type="submit"], .btn-primary {
            width: 100%;
            padding: 16px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 4px 6px -1px rgba(2, 132, 199, 0.2); /* Ombre bleu */
        }

        button[type="submit"]:hover, .btn-primary:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: 0 10px 15px -3px rgba(2, 132, 199, 0.3);
        }

        /* --- 6. CARTES & R√âSULTATS --- */
        #results-section, #searchResults {
            margin-top: 40px;
            animation: fadeIn 0.5s ease-out;
        }

        .result-header {
            display: flex; align-items: center; justify-content: space-between;
            margin-bottom: 32px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }
        .result-header h2 { margin: 0; font-size: 1.5rem; color: var(--text-main); }
        .badge {
            background: var(--primary-light);
            color: var(--primary);
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 700;
            border: 1px solid rgba(2, 132, 199, 0.1);
        }

        .jobs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 24px;
        }

        .job-card {
            background: var(--bg-surface);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 24px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            opacity: 0;
            animation: slideUp 0.5s forwards;
        }

        .job-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary); /* Bordure devient bleue au survol */
        }

        /* Trait bleu en haut au survol */
        .job-card::after {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 4px;
            background: var(--primary); opacity: 0; transition: opacity 0.3s ease;
        }
        .job-card:hover::after { opacity: 1; }

        .job-title {
            font-weight: 700;
            font-size: 1.15rem;
            margin-bottom: 12px;
            color: var(--text-main);
            padding-right: 30px;
        }

        .job-path {
            font-size: 0.9rem;
            color: var(--text-muted);
            background: var(--primary-light);
            padding: 14px;
            border-radius: var(--radius-sm);
            margin-top: 16px;
            border: 1px solid rgba(2, 132, 199, 0.1);
        }
        .job-path strong { color: var(--primary-hover); }

        /* Tags */
        .job-tag {
            display: inline-block;
            background: #ffffff;
            color: var(--text-muted);
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.8rem;
            margin-right: 6px;
            margin-bottom: 6px;
            border: 1px solid var(--border-color);
            transition: all 0.2s;
        }
        .job-tag:hover {
            border-color: var(--primary);
            color: var(--primary);
        }

        /* Salaire en Vert */
        .salary-box {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-top: 12px;
            font-weight: 600;
            color: var(--success);
            font-size: 0.9rem;
            background: rgba(16, 185, 129, 0.1);
            padding: 4px 10px;
            border-radius: 6px;
        }

        /* Fav Button */
        .fav-btn {
            position: absolute;
            top: 20px; right: 20px;
            background: none;
            border: none;
            cursor: pointer;
            color: var(--text-muted);
            font-size: 1.4rem;
            transition: transform 0.2s, color 0.2s;
        }
        .fav-btn:hover { transform: scale(1.2); color: var(--primary); }
        .fav-btn.active { color: var(--danger); }

        /* --- 7. FOOTER & TOAST --- */
        footer { text-align: center; margin-top: 50px; color: var(--text-muted); font-size: 0.9rem; }
        
        .toast {
            position: fixed; bottom: 24px; right: 24px;
            background: var(--bg-surface);
            color: var(--text-main);
            padding: 12px 20px;
            border-radius: var(--radius-sm);
            box-shadow: var(--shadow-lg);
            border-left: 4px solid var(--primary);
            z-index: 1000;
            font-weight: 500;
            animation: slideInRight 0.3s forwards;
        }

        /* --- ANIMATIONS --- */
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideInRight { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }

        /* --- RESPONSIVE --- */
        @media (max-width: 600px) {
            body { padding: 20px 10px; }
            header { padding: 40px 20px; }
            h1 { font-size: 1.8rem; }
            main { padding: 24px; border-radius: 16px; }
            .jobs-grid { grid-template-columns: 1fr; }
            #theme-toggle { top: 16px; right: 16px; font-size: 0.8rem; padding: 8px 12px; }
        }
    </style>
</head>
<body>

    <header>
        <button id="theme-toggle" aria-label="Changer le th√®me"></button>
        <h1>Mon Orientation Avenir</h1>
        <p class="subtitle">Syst√®me d'orientation intelligent - √âdition Maroc</p>
    </header>

    <main>
        <!-- SECTION 1 : FORMULAIRE -->
        <section class="form-section">
            <h3>Vos Informations Scolaires</h3>
            <form id="orientationForm">
                <div class="form-group">
                    <label for="niveau">Ann√©e Scolaire Actuelle</label>
                    <select id="niveau" required>
                        <option value="" disabled selected>-- Choisir l'ann√©e --</option>
                        <option value="college">Coll√®ge (3√®me Ann√©e)</option>
                        <option value="tc">Tronc Commun</option>
                        <option value="1ere">1√®re Ann√©e Baccalaur√©at</option>
                        <option value="term">2√®me Ann√©e Baccalaur√©at (Terminal)</option>
                    </select>
                </div>

                <div class="form-group" id="filiere-group">
                    <label for="filiere">Fili√®re</label>
                    <select id="filiere" required disabled>
                        <option value="" disabled selected>-- D'abord choisir l'ann√©e --</option>
                    </select>
                </div>

                <button type="submit">Obtenir mes suggestions</button>
            </form>
        </section>

        <!-- BARRE DE RECHERCHE -->
        <div style="margin-bottom: 40px;">
            <input type="text" id="searchInput" placeholder="üîç Rechercher un m√©tier (ex: Ing√©nieur, M√©decin)...">
            <div id="searchResults"></div>
        </div>

        <!-- SECTION 2 : R√âSULTATS -->
        <section id="results-section">
            <div class="result-header">
                <h2 id="result-title">R√©sultats</h2>
                <span class="badge" id="result-context"></span>
            </div>
            <div id="results-container"></div>
        </section>

        <!-- SECTION FAVORIS -->
        <section id="favorites-section">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h3 style="margin:0; color:var(--text-main);">‚ù§Ô∏è Mes Favoris</h3>
                <button id="clearFav" style="background:transparent; border:1px solid var(--danger); color:var(--danger); padding:6px 12px; border-radius:6px; cursor:pointer; font-size:0.85rem;">Tout effacer</button>
            </div>
            <div style="clear:both;"></div>
            <div id="favorites-container" class="jobs-grid"></div>
        </section>

    </main>

    <footer>
        &copy; 2023 Orientation Maroc - Module IA V3.0 (Design Bleu Pro)
    </footer>

    <!-- LOGIQUE JAVASCRIPT -->
    <script>
        const icons = {
            sun: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"></circle><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></svg>`,
            moon: `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path></svg>`
        };

        const baseMetiersMaroc = {
            "Sciences Math√©matiques": [
                { titre: "Ing√©nieur d'√âtat", path: "Bac SM ‚Üí CPGE (MPSI/PTSI) ‚Üí Concours CNC ‚Üí Grande √âcole", niveau: "lycee", salaire: "8k - 25k MAD", competences: ["Maths", "Physique", "Code"], secteur: "Industrie" },
                { titre: "M√©decin", path: "Bac SM ‚Üí Facult√© de M√©decine ‚Üí 7 ans ‚Üí R√©sidanat", niveau: "lycee", salaire: "Variable + Gardes", competences: ["Biologie", "Empathie", "Rigueur"], secteur: "Sant√©" },
                { titre: "Architecte", path: "Bac SM ‚Üí ENA (√âcole Nationale d'Architecture)", niveau: "lycee", salaire: "7k - 20k MAD", competences: ["Dessin", "3D", "Cr√©ativit√©"], secteur: "BTP" },
                { titre: "Data Scientist", path: "Bac SM ‚Üí FST Informatique/Maths ‚Üí Master Data", niveau: "lycee", salaire: "10k - 30k MAD", competences: ["Stats", "Python", "ML"], secteur: "Tech" }
            ],
            "Sciences Exp√©rimentales": [
                { titre: "M√©decin / Dentiste", path: "Bac SE ‚Üí Facult√© de M√©decine/Pharmacie", niveau: "lycee", salaire: "Variable", competences: ["Biologie", "Chimie"], secteur: "Sant√©" },
                { titre: "Ing√©nieur Agronome", path: "Bac SE ‚Üí IAV Hassan II", niveau: "lycee", salaire: "7k - 18k MAD", competences: ["Agronomie", "√âcologie"], secteur: "Agro" },
                { titre: "Biologiste", path: "Bac SE ‚Üí FST ‚Üí Master Recherche", niveau: "lycee", salaire: "6k - 15k MAD", competences: ["Labo", "Analyse"], secteur: "Recherche" },
                { titre: "Infirmier", path: "Bac SE ‚Üí ISTA Sp√©cialis√©", niveau: "lycee", salaire: "4k - 8k MAD", competences: ["Soins", "Patience"], secteur: "Sant√©" }
            ],
            "Sciences √âconomiques": [
                { titre: "Manager / Chef d'Entreprise", path: "Bac SEG ‚Üí ENCG ou ISCAE", niveau: "lycee", salaire: "8k - 40k+ MAD", competences: ["Leadership", "Gestion"], secteur: "Business" },
                { titre: "Expert-Comptable", path: "Bac SEG ‚Üí ESC ou Universit√©", niveau: "lycee", salaire: "6k - Illimit√©", competences: ["Comptabilit√©", "Audit"], secteur: "Finance" },
                { titre: "Marketing / Commercial", path: "Bac SEG -> √âcole Commerce", niveau: "lycee", salaire: "5k - 20k MAD", competences: ["Vente", "Digital"], secteur: "Commerce" },
                { titre: "Agent Bancaire", path: "Bac SEG ‚Üí OFPPT / Universit√©", niveau: "lycee", salaire: "4k - 9k MAD", competences: ["Finance", "Service"], secteur: "Banque" }
            ],
            "Lettres et Sciences Humaines": [
                { titre: "Professeur Secondaire", path: "Bac LSH ‚Üí CRMEF", niveau: "lycee", salaire: "5k - 9k MAD", competences: ["P√©dagogie", "Com. Orale"], secteur: "√âducation" },
                { titre: "Journaliste", path: "Bac LSH ‚Üí ESJ ou Inst. Com.", niveau: "lycee", salaire: "5k - 15k MAD", competences: ["R√©daction", "Investigation"], secteur: "M√©dia" },
                { titre: "Psychologue", path: "Bac LSH ‚Üí Facult√© Lettres ‚Üí Master", niveau: "lycee", salaire: "5k - 12k MAD", competences: ["√âcoute", "Analyse"], secteur: "Social" },
                { titre: "Avocat", path: "Bac LSH ‚Üí Facult√© de Droit", niveau: "lycee", salaire: "Illimit√©", competences: ["Droit", "Plaidoirie"], secteur: "Justice" }
            ]
        };

        // DOM Elements
        const niveauSelect = document.getElementById('niveau');
        const filiereSelect = document.getElementById('filiere');
        const form = document.getElementById('orientationForm');
        const resultsSection = document.getElementById('results-section');
        const resultsContainer = document.getElementById('results-container');
        const searchResults = document.getElementById('searchResults');
        const searchInput = document.getElementById('searchInput');

        const filieresParNiveau = {
            "college": [], "tc": [], "1ere": ["Sciences Math√©matiques", "Sciences Exp√©rimentales", "Sciences √âconomiques", "Lettres et Sciences Humaines"],
            "term": ["Sciences Math√©matiques", "Sciences Exp√©rimentales", "Sciences √âconomiques", "Lettres et Sciences Humaines"]
        };

        niveauSelect.addEventListener('change', function() {
            const niveau = this.value;
            filiereSelect.innerHTML = '<option value="" disabled selected>-- Choisir la fili√®re --</option>';
            if (filieresParNiveau[niveau]) {
                if (niveau === "college" || niveau === "tc") {
                    const opt = document.createElement('option');
                    opt.value = "General"; 
                    opt.textContent = niveau === "college" ? "Cycle Coll√©gial" : "Tronc Commun (Tous)";
                    filiereSelect.appendChild(opt);
                } else {
                    filieresParNiveau[niveau].forEach(f => {
                        const opt = document.createElement('option');
                        opt.value = f;
                        opt.textContent = f;
                        filiereSelect.appendChild(opt);
                    });
                }
                filiereSelect.disabled = false;
            } else {
                filiereSelect.disabled = true;
            }
        });

        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const niveau = niveauSelect.value;
            const filiere = filiereSelect.value;
            searchResults.style.display = 'none';
            searchInput.value = '';
            
            resultsSection.style.display = 'block';
            resultsContainer.innerHTML = '<div style="text-align:center; padding:40px; color:var(--text-muted);">Analyse en cours...</div>';
            document.getElementById('result-context').textContent = `${niveau.toUpperCase()} - ${filiere.toUpperCase()}`;

            setTimeout(() => {
                afficherResultats(niveau, filiere);
                resultsSection.scrollIntoView({ behavior: 'smooth' });
            }, 500);
        });

        function afficherResultats(niveau, filiere) {
            resultsContainer.innerHTML = '';
            if (niveau === "college" || niveau === "tc") {
                afficherMessage(niveau === "college" ? "Concentrez-vous sur les sciences pour ouvrir le maximum de portes." : "C'est le moment de choisir votre voie selon vos aptitudes.");
                afficherCartes(baseMetiersMaroc["Sciences Math√©matiques"].slice(0,1));
                afficherCartes(baseMetiersMaroc["Sciences √âconomiques"].slice(0,1));
                return;
            }
            const suggestions = baseMetiersMaroc[filiere] || [];
            afficherCartes(suggestions);
        }

        function afficherMessage(msg) {
            const div = document.createElement('div');
            div.style.cssText = "background:var(--primary-light); color:var(--primary); padding:16px; border-radius:8px; margin-bottom:20px; text-align:center; font-weight:500;";
            div.textContent = msg;
            resultsContainer.appendChild(div);
        }

        function afficherCartes(liste, targetContainer = resultsContainer, isFavList = false) {
            liste.forEach((job, i) => {
                const card = document.createElement('div');
                card.className = "job-card";
                card.style.animationDelay = `${i * 0.05}s`;
                
                const jobId = job.titre.replace(/\s+/g, '-');
                const isFav = localStorage.getItem('fav_' + jobId) === 'true';
                
                let tags = job.competences ? job.competences.map(c => `<span class="job-tag">${c}</span>`).join('') : '';

                card.innerHTML = `
                    <button class="fav-btn ${isFav ? 'active' : ''}" onclick="toggleFav('${jobId}', this)">‚ô•</button>
                    <div class="job-title">${job.titre}</div>
                    ${job.salaire ? `<div class="salary-box">üí∞ ${job.salaire}</div>` : ''}
                    <div class="job-path"><strong>Parcours :</strong> ${job.path}</div>
                    <div style="margin-top:12px;">${tags}</div>
                    ${job.secteur ? `<div style="margin-top:10px; font-size:0.8rem; color:var(--text-muted);">üè¢ ${job.secteur}</div>` : ''}
                `;
                targetContainer.appendChild(card);
            });
        }

        function toggleFav(id, btn) {
            const status = !(localStorage.getItem('fav_' + id) === 'true');
            localStorage.setItem('fav_' + id, status);
            btn.classList.toggle('active');
            showToast(status ? "Ajout√© aux favoris" : "Retir√© des favoris");
            renderFavorites();
        }

        function renderFavorites() {
            const container = document.getElementById('favorites-container');
            const section = document.getElementById('favorites-section');
            container.innerHTML = '';
            let favs = [];
            Object.values(baseMetiersMaroc).forEach(arr => arr.forEach(j => {
                if(localStorage.getItem('fav_' + j.titre.replace(/\s+/g, '-')) === 'true') favs.push(j);
            }));
            if(favs.length) {
                section.style.display = 'block';
                afficherCartes(favs, container, true);
            } else {
                section.style.display = 'none';
            }
        }

        function showToast(msg) {
            const t = document.createElement('div');
            t.className = 'toast'; t.textContent = msg;
            document.body.appendChild(t);
            setTimeout(() => { t.style.opacity = '0'; setTimeout(() => t.remove(), 300); }, 2000);
        }

        document.getElementById('clearFav').onclick = () => {
            if(confirm("Effacer tout ?")) {
                localStorage.clear();
                document.querySelectorAll('.fav-btn').forEach(b => b.classList.remove('active'));
                renderFavorites();
            }
        };

        searchInput.addEventListener('input', (e) => {
            const q = e.target.value.toLowerCase();
            if(q.length < 2) { searchResults.style.display = 'none'; return; }
            resultsSection.style.display = 'none'; searchResults.style.display = 'block';
            searchResults.innerHTML = '<h3 style="color:var(--text-main); margin-bottom:20px;">Recherche</h3>';
            const grid = document.createElement('div'); grid.className = 'jobs-grid';
            let found = [];
            Object.values(baseMetiersMaroc).forEach(arr => arr.forEach(j => {
                if(j.titre.toLowerCase().includes(q)) found.push(j);
            }));
            if(found.length) afficherCartes(found, grid);
            else searchResults.innerHTML += '<p style="color:var(--text-muted)">Aucun r√©sultat.</p>';
            searchResults.appendChild(grid);
        });

        // Theme Logic
        const themeBtn = document.getElementById('theme-toggle');
        function setTheme(t) {
            document.documentElement.setAttribute('data-theme', t);
            themeBtn.innerHTML = (t === 'dark' ? icons.sun + ' Mode Jour' : icons.moon + ' Mode Nuit');
            localStorage.setItem('theme', t);
        }
        themeBtn.onclick = () => setTheme(document.documentElement.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
        
        const saved = localStorage.getItem('theme');
        if(saved) setTheme(saved);
        else if(window.matchMedia('(prefers-color-scheme: dark)').matches) setTheme('dark');
        else setTheme('light');
        
        window.addEventListener('DOMContentLoaded', renderFavorites);
    </script>
</body>
</html>